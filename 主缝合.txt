local LBLG = Instance.new("ScreenGui")
local LBL = Instance.new("TextLabel")
local PlayerLabel = Instance.new("TextLabel")
local player = game.Players.LocalPlayer

LBLG.Name = "LBLG"
LBLG.Parent = game.CoreGui
LBLG.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
LBLG.Enabled = true

LBL.Name = "LBL"
LBL.Parent = LBLG
LBL.BackgroundColor3 = Color3.new(1, 1, 1)
LBL.BackgroundTransparency = 1
LBL.BorderColor3 = Color3.new(0, 0, 0)
LBL.Position = UDim2.new(0, 5, 0, 10)
LBL.Size = UDim2.new(0, 250, 0, 35)
LBL.Font = Enum.Font.GothamSemibold
LBL.Text = "时间:加载中..."
LBL.TextColor3 = Color3.new(1, 1, 1)
LBL.TextScaled = false
LBL.TextSize = 22
LBL.TextWrapped = false
LBL.Visible = true
LBL.TextXAlignment = Enum.TextXAlignment.Left
LBL.TextYAlignment = Enum.TextYAlignment.Top
LBL.ZIndex = 10

LBL.TextSize = 18
LBL.Size = UDim2.new(0, 250, 0, 30)
LBL.Position = UDim2.new(1, -255, 0, 10)
LBL.TextXAlignment = Enum.TextXAlignment.Right

local Heartbeat = game:GetService("RunService").Heartbeat
local LastIteration, Start
local FrameUpdateTable = { }

local function HeartbeatUpdate()
    LastIteration = tick()
    for Index = #FrameUpdateTable, 1, -1 do
        FrameUpdateTable[Index + 1] = (FrameUpdateTable[Index] >= LastIteration - 1) and FrameUpdateTable[Index] or nil
    end
    FrameUpdateTable[1] = LastIteration
    local CurrentFPS = (tick() - Start >= 1 and #FrameUpdateTable) or (#FrameUpdateTable / (tick() - Start))
    CurrentFPS = CurrentFPS - CurrentFPS % 1
    
    local hue = tick() % 5 / 5
    local r = math.sin(hue * 6.28 + 0) * 127 + 128
    local g = math.sin(hue * 6.28 + 2) * 127 + 128
    local b = math.sin(hue * 6.28 + 4) * 127 + 128
    local color = Color3.fromRGB(r, g, b)
    
    LBL.Text = ("北京时间:"..os.date("%H").."时"..os.date("%M").."分"..os.date("%S"))
    LBL.TextColor3 = color
    PlayerLabel.TextColor3 = color
end
Start = tick()
Heartbeat:Connect(HeartbeatUpdate)

local ESPLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/mstudio45/MSESP/refs/heads/main/source.luau"))()

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

local Window = WindUI:CreateWindow({
    Title = "挽",
    Icon = "code",
    Author = "by挽＆MT",
    Folder = "mtaskh",
    Size = UDim2.fromOffset(850, 950),
    Theme = "Light",
    HideSearchBar = false,
    ScrollBarEnabled = true,
    Resizable = true,
    Background = "https://raw.githubusercontent.com/mtaskhh/script/refs/heads/Other/retouch_2025101321572104.jpg",
    Transparent = true,
    BackgroundImageTransparency = 0.5,
    User = {
    Enabled = true,
    Callback = function()
        WindUI:Notify({
            Title = "点击了自己",
            Content = "是的,你很好看", 
            Duration = 3,
            Icon = "sun"
        })
    end,
    Anonymous = false
}
})

Window:SetBackgroundImageTransparency(0.5)

Window:CreateTopbarButton("ThemeToggle", "moon", function()
    local currentTheme = WindUI:GetCurrentTheme()
    if currentTheme == "Light" then
        WindUI:SetTheme("Dark")
        WindUI:Notify({
            Title = "已切换为光亮黑暗主题",
            Content = "",
            Duration = 3,
            Icon = "geist:moon"
        })
    else
        WindUI:SetTheme("Light")
        WindUI:Notify({
            Title = "已切换为光亮主题",
            Content = "",
            Duration = 3,
            Icon = "geist:sun"
        })
    end
end, 990)

WindUI:SetNotificationLower(true)

Window:EditOpenButton({
    Title = "打开挽脚本",
    Icon = "lucide:scroll-text",
    CornerRadius = UDim.new(0,16),
    StrokeThickness = 6,
    Color = ColorSequence.new(
Color3.fromHex("ADD8E6"),
Color3.fromHex("FFFFFF")
    ),
    OnlyMobile = false,
    Enabled = true,
    Draggable = true,
})

local infoTab = Window:Tab({Title = "信息", Icon = "user", Locked = false})

local DefaultTab = Window:Tab({Title = "公告", Icon = "geist:credit-card", Locked = false})

local firstTab = Window:Tab({Title = "通用类", Icon = "settings", Locked = false})

local thirdTab = Window:Tab({Title = "视觉类", Icon = "eye", Locked = false})

local secondTab = Window:Tab({Title = "自瞄范围类", Icon = "target", Locked = false})

local TeleportTab = Window:Tab({Title = "传送与甩飞", Icon = "lucide:move-3d"})

local SpinTab = Window:Tab({Title = "旋转", Icon = "rotate-cw", Locked = false})

local serve1 = Window:Tab({Title = "服务器列表1", Icon = "book", Locked = false})

local FETab = Window:Tab({Title = "FE脚本", Icon = "lucide:zap"})

local MusicTab = Window:Tab({Title = "音乐播放器", Icon = "music", Locked = false})

local infoSection = infoTab:Section({Title = "详情", Opened = true})

infoSection:Paragraph({
    Title = "挽脚本",
    Desc = "作者Mtaskh＆挽鹤\n作者qq:1048324261＆3345179204\n脚本还在测试中",
})

infoSection:Paragraph({
    Title = "账号注册时间",
    Desc = tostring(game.Players.LocalPlayer.AccountAge).."天"
})

infoSection:Paragraph({
    Title = "服务器ID", 
    Desc = tostring(game.GameId)
})

infoSection:Paragraph({
    Title = "用户ID",
    Desc = tostring(game.Players.LocalPlayer.UserId)
})

infoSection:Paragraph({
    Title = "客户端ID",
    Desc = tostring(game:GetService("RbxAnalyticsService"):GetClientId())
})

infoSection:Paragraph({
    Title = "注入器",
    Desc = identifyexecutor and identifyexecutor() or "未知"
})

infoSection:Paragraph({
    Title = "用户名",
    Desc = game.Players.LocalPlayer.Name
})

infoSection:Paragraph({
    Title = "服务器名称", 
    Desc = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name
})

DefaultTab:Paragraph({
    Title = "关于",
    Desc = "随便做的请勿拿别的半缝合来对比\n感谢支持并使用挽脚本",
    ThumbnailSize = 190
})

DefaultTab:Button({
    Title = "重进", 
    Desc = "重新进服务器",
    Callback = function()
game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, game:GetService("Players").LocalPlayer)
if not pcall(function()
    game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, game:GetService("Players").LocalPlayer)
end) then
    game:GetService("TeleportService"):Teleport(game.PlaceId)
end
    end
})

local GeneralSection = firstTab:Section({Title = "基础设置", Opened = true, Icon = "lucide:align-horizontal-distribute-center"})

local fovValue = Workspace.CurrentCamera.FieldOfView
local fovEnabled = false
local fovConnection

GeneralSection:Slider({
    Title = "视野",
    Desc = "FieldOfView",
    Step = 1,
    Value = {Min = 10, Max = 180, Default = Workspace.CurrentCamera.FieldOfView},
    Input = true,
    Callback = function(value)
        fovValue = value
        if fovEnabled then
            Workspace.CurrentCamera.FieldOfView = fovValue
        end
    end
})

GeneralSection:Toggle({
    Title = "视野开关",
    Value = false,
    Callback = function(state)
        fovEnabled = state
        if state then
            if fovConnection then
                fovConnection:Disconnect()
            end
            fovConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if fovEnabled then
                    Workspace.CurrentCamera.FieldOfView = fovValue
                end
            end)
        else
            if fovConnection then
                fovConnection:Disconnect()
                fovConnection = nil
            end
            Workspace.CurrentCamera.FieldOfView = 70
        end
    end
})

local zoomDistance = 100
local zoomDistanceEnabled = false
local zoomDistanceConnection

GeneralSection:Slider({
    Title = "视角缩放距离",
    Desc = "CameraZoom",
    Step = 0.5,
    Value = {Min = 0.5, Max = 1000000, Default = 100},
    Input = true,
    Callback = function(distance)
        zoomDistance = distance
        if zoomDistanceEnabled then
            local player = game.Players.LocalPlayer
            if player then
                player.CameraMaxZoomDistance = zoomDistance
                player.CameraMinZoomDistance = 0.5
            end
        end
    end
})

GeneralSection:Toggle({
    Title = "缩放开关",
    Value = false,
    Callback = function(state)
        zoomDistanceEnabled = state
        if state then
            if zoomDistanceConnection then
                zoomDistanceConnection:Disconnect()
            end
            zoomDistanceConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if zoomDistanceEnabled then
                    local player = game.Players.LocalPlayer
                    if player then
                        player.CameraMaxZoomDistance = zoomDistance
                        player.CameraMinZoomDistance = 0.5
                    end
                end
            end)
        else
            if zoomDistanceConnection then
                zoomDistanceConnection:Disconnect()
                zoomDistanceConnection = nil
            end
            local player = game.Players.LocalPlayer
            if player then
                player.CameraMaxZoomDistance = 100
                player.CameraMinZoomDistance = 0.5
            end
        end
    end
})

local walkSpeed = 16
local walkSpeedEnabled = false
local walkSpeedConnection

GeneralSection:Slider({
    Title = "步行速度",
    Desc = "WalkSpeed",
    Step = 1,
    Value = {Min = 1, Max = 400, Default = 16},
    Input = true,
    Callback = function(speed)
        walkSpeed = speed
    end
})

GeneralSection:Toggle({
    Title = "速度开关",
    Value = false,
    Callback = function(state)
        walkSpeedEnabled = state
        if state then
            if walkSpeedConnection then
                walkSpeedConnection:Disconnect()
            end
            walkSpeedConnection = game:GetService("RunService").Heartbeat:Connect(function()
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChildOfClass("Humanoid") and walkSpeedEnabled then
                    character.Humanoid.WalkSpeed = walkSpeed
                end
            end)
        else
            if walkSpeedConnection then
                walkSpeedConnection:Disconnect()
                walkSpeedConnection = nil
            end
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChildOfClass("Humanoid") then
                character.Humanoid.WalkSpeed = 16
            end
        end
    end
})

local jumpPower = 50
local jumpEnabled = false
local jumpConnection

GeneralSection:Slider({
    Title = "跳跃高度",
    Desc = "JumpPower",
    Step = 1,
    Value = {Min = 0, Max = 2000, Default = 50},
    Input = true,
    Callback = function(power)
        jumpPower = power
    end
})

GeneralSection:Toggle({
    Title = "跳高开关",
    Value = false,
    Callback = function(state)
        jumpEnabled = state
        if state then
            if jumpConnection then
                jumpConnection:Disconnect()
            end
            jumpConnection = game:GetService("RunService").Heartbeat:Connect(function()
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChildOfClass("Humanoid") and jumpEnabled then
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    humanoid.JumpPower = jumpPower
                    humanoid.JumpHeight = jumpPower / 7
                end
            end)
        else
            if jumpConnection then
                jumpConnection:Disconnect()
                jumpConnection = nil
            end
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChildOfClass("Humanoid") then
                character.Humanoid.JumpPower = 50
                character.Humanoid.JumpHeight = 50 / 7
            end
        end
    end
})

local gravityValue = game.Workspace.Gravity
local gravityEnabled = false
local gravityConnection

GeneralSection:Slider({
    Title = "重力设置（默认196.2 调高起不了身）",
    Desc = "Gravity",
    Step = 1,
    Value = {Min = 1, Max = 2000, Default = game.Workspace.Gravity},
    Input = true,
    Callback = function(value)
        gravityValue = value
        if gravityEnabled then
            game.Workspace.Gravity = gravityValue
        end
    end
})

GeneralSection:Toggle({
    Title = "重力开关",
    Value = false,
    Callback = function(state)
        gravityEnabled = state
        if state then
            if gravityConnection then
                gravityConnection:Disconnect()
            end
            gravityConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if gravityEnabled then
                    game.Workspace.Gravity = gravityValue
                end
            end)
        else
            if gravityConnection then
                gravityConnection:Disconnect()
                gravityConnection = nil
            end
            game.Workspace.Gravity = 196.2
        end
    end
})

local healthMaxValue = 100
local healthMaxEnabled = false
local healthMaxConnection

GeneralSection:Slider({
    Title = "最大血量",
    Desc = "MaxHealth",
    Step = 1,
    Value = {Min = 1, Max = 10000, Default = 100},
    Input = true,
    Callback = function(value)
        healthMaxValue = value
        if healthMaxEnabled then
            local humanoid = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then 
                humanoid.MaxHealth = healthMaxValue
            end
        end
    end
})

GeneralSection:Toggle({
    Title = "最大血量开关",
    Value = false,
    Callback = function(state)
        healthMaxEnabled = state
        if state then
            if healthMaxConnection then
                healthMaxConnection:Disconnect()
            end
            healthMaxConnection = game:GetService("RunService").Heartbeat:Connect(function()
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChildOfClass("Humanoid") and healthMaxEnabled then
                    character.Humanoid.MaxHealth = healthMaxValue
                end
            end)
        else
            if healthMaxConnection then
                healthMaxConnection:Disconnect()
                healthMaxConnection = nil
            end
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChildOfClass("Humanoid") then
                character.Humanoid.MaxHealth = 100
            end
        end
    end
})

local healthCurrentValue = 100
local healthCurrentEnabled = false
local healthCurrentConnection

GeneralSection:Slider({
    Title = "当前血量",
    Desc = "CurrentHealth",
    Step = 1,
    Value = {Min = 1, Max = 10000, Default = 100},
    Input = true,
    Callback = function(value)
        healthCurrentValue = value
        if healthCurrentEnabled then
            local humanoid = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then 
                humanoid.Health = healthCurrentValue
            end
        end
    end
})

GeneralSection:Toggle({
    Title = "当前血量开关",
    Value = false,
    Callback = function(state)
        healthCurrentEnabled = state
        if state then
            if healthCurrentConnection then
                healthCurrentConnection:Disconnect()
            end
            healthCurrentConnection = game:GetService("RunService").Heartbeat:Connect(function()
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChildOfClass("Humanoid") and healthCurrentEnabled then
                    character.Humanoid.Health = healthCurrentValue
                end
            end)
        else
            if healthCurrentConnection then
                healthCurrentConnection:Disconnect()
                healthCurrentConnection = nil
            end
        end
    end
})

GeneralSection:Divider()

GeneralSection:Button({
    Title = "FPS显示",
    Desc = "显示FPS计数器",
    Icon = "monitor",
    Callback = function()
        local RunService = game:GetService("RunService")
        local CoreGui = game:GetService("CoreGui")

        if CoreGui:FindFirstChild("FPSDisplay") then
            CoreGui.FPSDisplay:Destroy()
        end

        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "FPSDisplay"
        screenGui.Parent = CoreGui
        screenGui.ResetOnSpawn = false

        local textLabel = Instance.new("TextLabel")
        textLabel.Text = "FPS: 0"
        textLabel.TextSize = 18
        textLabel.Font = Enum.Font.GothamBold
        textLabel.BackgroundTransparency = 1
        textLabel.TextXAlignment = Enum.TextXAlignment.Left
        textLabel.TextYAlignment = Enum.TextYAlignment.Top
        textLabel.Size = UDim2.new(0, 200, 0, 30)
        textLabel.Position = UDim2.new(0, 10, 0, 10)
        textLabel.AnchorPoint = Vector2.new(0, 0)
        textLabel.ZIndex = 10
        textLabel.Parent = screenGui

        local hue = 0
        local lastUpdate = 0

        RunService.Heartbeat:Connect(function()
            local currentTime = tick()
            if currentTime - lastUpdate >= 0.1 then
                local fps = math.floor(1 / RunService.Heartbeat:Wait())
                hue = (hue + 0.005) % 1  
                local color = Color3.fromHSV(hue, 1, 1)
                textLabel.Text = "FPS: " .. fps
                textLabel.TextColor3 = color
                lastUpdate = currentTime
            end
        end)
    end
})

GeneralSection:Toggle({
    Title = "耐摔王",
    Desc = "what can i say",
    Icon = "geist:accessibility",
    Default = true,
    Callback = function(Value)
        if Value then
            local rs = game:GetService("RunService")
            local hb = rs.Heartbeat
            local rsd = rs.RenderStepped
            local lp = game.Players.LocalPlayer
            local z = Vector3.zero
            
            local function f(c)
                local r = c:WaitForChild("HumanoidRootPart")
                if r then
                    local con
                    con = hb:Connect(function()
                        if not r.Parent then
                            con:Disconnect()
                            return
                        end
                        local v = r.AssemblyLinearVelocity
                        r.AssemblyLinearVelocity = z
                        rsd:Wait()
                        r.AssemblyLinearVelocity = v
                    end)
                end
            end
            
            f(lp.Character)
            lp.CharacterAdded:Connect(f)
        end
    end
})

local CameraSection = firstTab:Section({Title = "镜头设置", Icon = "camera", Opened = false})

CameraSection:Button({
    Title = "第一人称",
    Desc = "切换到第一人称视角",
    Callback = function()
        game.Players.LocalPlayer.CameraMaxZoomDistance = 0.5
        game.Players.LocalPlayer.CameraMode = Enum.CameraMode.LockFirstPerson
        
        local function setFirstPerson()
            game.Players.LocalPlayer.CameraMaxZoomDistance = 0.5
            game.Players.LocalPlayer.CameraMode = Enum.CameraMode.LockFirstPerson
        end
        
        setFirstPerson()
        
        game.Players.LocalPlayer.CharacterAdded:Connect(function()
            wait(1)
            setFirstPerson()
        end)
        
        WindUI:Notify({
            Title = "视角切换",
            Content = "已切换到第一人称",
            Duration = 2,
            Icon = "user"
        })
    end
})

CameraSection:Button({
    Title = "第三人称",
    Desc = "切换到第三人称视角",
    Callback = function()
        game.Players.LocalPlayer.CameraMaxZoomDistance = 50
        game.Players.LocalPlayer.CameraMode = Enum.CameraMode.Classic
        
        local function setThirdPerson()
            game.Players.LocalPlayer.CameraMaxZoomDistance = 50
            game.Players.LocalPlayer.CameraMode = Enum.CameraMode.Classic
        end
        
        setThirdPerson()
        
        game.Players.LocalPlayer.CharacterAdded:Connect(function()
            wait(1)
            setThirdPerson()
        end)
        
        WindUI:Notify({
            Title = "视角切换",
            Content = "已切换到第三人称,手动缩放视角即可",
            Duration = 2,
            Icon = "users"
        })
    end
})

local ToolSection = firstTab:Section({Title = "工具功能", Opened = false, Icon="lucide:wrench"})

ToolSection:Button({
    Title = "玩家加入游戏提示",
    Desc = "显示玩家加入提示",
    Icon = "user-plus",
    Callback = function()
        loadstring(game:HttpGet('https://raw.githubusercontent.com/boyscp/scriscriptsc/main/bbn.lua'))()
    end
})

ToolSection:Button({
    Title = "飞行",
    Desc = "fly Script",
    Icon = "user",
    Callback = function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/XxwanhexxX/321/refs/heads/main/%E4%B8%BBUI'))()
    end
})

ToolSection:Button({
    Title = "汉化悬浮ui穿墙",
    Desc = "加载汉化穿墙功能",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/TtmScripter/OtherScript/main/Noclip"))()
    end
})

ToolSection:Button({
    Title = "踏空ui",
    Desc = "加载踏空行走功能",
    Callback = function()
        loadstring(game:HttpGet('https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Float', true))()
    end
})

ToolSection:Button({
    Title = "解锁第三人称",
    Desc = "解锁第三人称视角",
    Callback = function()
        game.Players.LocalPlayer.CameraMaxZoomDistance = 50
        game.Players.LocalPlayer.CameraMode = Enum.CameraMode.Classic
    end
})

ToolSection:Button({
    Title = "紫砂",
    Desc = "重置本地玩家",
    Icon = "geist:user",
    Callback = function()
        game.Players.LocalPlayer.Character.Humanoid.Health = 0
    end
})

ToolSection:Button({
    Title = "死亡笔记",
    Desc = "死亡笔记功能",
    Icon = "book",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/dingding123hhh/tt/main/%E6%AD%BB%E4%BA%A1%E7%AC%94%E8%AE%B0%20(1).txt"))()
    end
})

ToolSection:Button({
    Title = "npc追踪",
    Desc = "透视npc",
    Icon = "robot",
    Callback = function()
        local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NPC追踪器"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

local toggleBtn = Instance.new("TextButton")
toggleBtn.Name = "隐藏显示按钮"
toggleBtn.Size = UDim2.new(0, 40, 0, 40)
toggleBtn.Position = UDim2.new(0, 5, 0.5, -20)  
toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
toggleBtn.BackgroundTransparency = 0.3
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.TextSize = 20
toggleBtn.Text = "<"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.BorderSizePixel = 0
toggleBtn.AutoButtonColor = false
toggleBtn.ZIndex = 10

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0.5, 0)
corner.Parent = toggleBtn

toggleBtn.Parent = screenGui

local mainFrame = Instance.new("Frame")
mainFrame.Name = "主窗口"
mainFrame.Size = UDim2.new(0.3, 0, 0.3, 0)
mainFrame.Position = UDim2.new(0.5, -mainFrame.Size.X.Offset/2, 0.5, -mainFrame.Size.Y.Offset/2)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local titleBar = Instance.new("Frame")
titleBar.Name = "标题栏"
titleBar.Size = UDim2.new(1, 0, 0.15, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
titleBar.BorderSizePixel = 0
titleBar.ZIndex = 2
titleBar.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "标题"
titleLabel.Size = UDim2.new(0.7, 0, 1, 0)
titleLabel.Position = UDim2.new(0.05, 0, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "NPC追踪器"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 14
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.ZIndex = 2
titleLabel.Parent = titleBar

local closeButton = Instance.new("TextButton")
closeButton.Name = "关闭按钮"
closeButton.Size = UDim2.new(0.15, 0, 1, 0)
closeButton.Position = UDim2.new(0.85, 0, 0, 0)
closeButton.BackgroundTransparency = 1
closeButton.Text = "✕"
closeButton.TextColor3 = Color3.fromRGB(255, 100, 100)
closeButton.TextSize = 16
closeButton.ZIndex = 2
closeButton.Parent = titleBar

local contentFrame = Instance.new("Frame")
contentFrame.Name = "内容区"
contentFrame.Size = UDim2.new(1, 0, 0.85, 0)
contentFrame.Position = UDim2.new(0, 0, 0.15, 0)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

local trackerLabel = Instance.new("TextLabel")
trackerLabel.Name = "定位标签"
trackerLabel.Size = UDim2.new(0.6, 0, 0.15, 0)
trackerLabel.Position = UDim2.new(0.05, 0, 0.1, 0)
trackerLabel.BackgroundTransparency = 1
trackerLabel.Text = "NPC定位:"
trackerLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
trackerLabel.TextXAlignment = Enum.TextXAlignment.Left
trackerLabel.Font = Enum.Font.Gotham
trackerLabel.TextSize = 14
trackerLabel.Parent = contentFrame

local trackerToggle = Instance.new("TextButton")
trackerToggle.Name = "定位开关"
trackerToggle.Size = UDim2.new(0.1, 0, 0.15, 0)
trackerToggle.Position = UDim2.new(0.6, 0, 0.1, 0)
trackerToggle.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
trackerToggle.Text = ""
trackerToggle.BorderSizePixel = 0
trackerToggle.Parent = contentFrame

local trackerToggleInner = Instance.new("Frame")
trackerToggleInner.Name = "开关内部"
trackerToggleInner.Size = UDim2.new(0.4, 0, 0.8, 0)
trackerToggleInner.Position = UDim2.new(0.05, 0, 0.1, 0)
trackerToggleInner.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
trackerToggleInner.BorderSizePixel = 0
trackerToggleInner.Parent = trackerToggle

local highlightLabel = Instance.new("TextLabel")
highlightLabel.Name = "高亮标签"
highlightLabel.Size = UDim2.new(0.6, 0, 0.15, 0)
highlightLabel.Position = UDim2.new(0.05, 0, 0.35, 0)
highlightLabel.BackgroundTransparency = 1
highlightLabel.Text = "NPC高亮:"
highlightLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
highlightLabel.TextXAlignment = Enum.TextXAlignment.Left
highlightLabel.Font = Enum.Font.Gotham
highlightLabel.TextSize = 14
highlightLabel.Parent = contentFrame

local highlightToggle = Instance.new("TextButton")
highlightToggle.Name = "高亮开关"
highlightToggle.Size = UDim2.new(0.1, 0, 0.15, 0)
highlightToggle.Position = UDim2.new(0.6, 0, 0.35, 0)
highlightToggle.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
highlightToggle.Text = ""
highlightToggle.BorderSizePixel = 0
highlightToggle.Parent = contentFrame

local highlightToggleInner = Instance.new("Frame")
highlightToggleInner.Name = "开关内部"
highlightToggleInner.Size = UDim2.new(0.4, 0, 0.8, 0)
highlightToggleInner.Position = UDim2.new(0.05, 0, 0.1, 0)
highlightToggleInner.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
highlightToggleInner.BorderSizePixel = 0
highlightToggleInner.Parent = highlightToggle

local refreshButton = Instance.new("TextButton")
refreshButton.Name = "刷新按钮"
refreshButton.Size = UDim2.new(0.9, 0, 0.2, 0)
refreshButton.Position = UDim2.new(0.05, 0, 0.65, 0)
refreshButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
refreshButton.BorderSizePixel = 0
refreshButton.Text = "刷新NPC"
refreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)
refreshButton.Font = Enum.Font.GothamBold
refreshButton.TextSize = 14
refreshButton.Parent = contentFrame

local isWindowVisible = true  
local isTrackerEnabled = true  
local isHighlightEnabled = true  

local trackedNPCs = {}  
local npcBillboards = {}  
local npcHighlights = {}  
local updateConn = nil  

local isDragging = false
local dragStartPos
local frameStartPos

local function getPlayerCharacter()
    return Player.Character or Player.CharacterAdded:Wait()
end

local function getPlayerRoot()
    local character = getPlayerCharacter()
    if not character then return nil end
    return character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso") or character:FindFirstChild("UpperTorso")
end

local function isNPC(model)
    if not model:IsA("Model") then return false end
    
    local humanoid = model:FindFirstChildOfClass("Humanoid")
    local rootPart = model:FindFirstChild("HumanoidRootPart") or model:FindFirstChild("Head") or model.PrimaryPart
    
    if humanoid and rootPart then
        for _, player in ipairs(Players:GetPlayers()) do
            if player.Character == model then
                return false
            end
        end
        return true
    end
    return false
end

local function findNPCs()
    local npcs = {}
    
    for _, obj in ipairs(workspace:GetChildren()) do
        if isNPC(obj) then
            table.insert(npcs, obj)
        end
    end
    
    for _, folder in ipairs(workspace:GetChildren()) do
        if folder:IsA("Folder") or folder:IsA("Model") then
            for _, obj in ipairs(folder:GetDescendants()) do
                if isNPC(obj) then
                    table.insert(npcs, obj)
                end
            end
        end
    end
    
    return npcs
end

local function createHighlight(npc)
    local highlight = Instance.new("Highlight")
    highlight.Name = "NPC高亮"
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillColor = Color3.new(0, 1, 1)  
    highlight.FillTransparency = 0.2
    highlight.OutlineColor = Color3.new(0, 1, 0)  
    highlight.OutlineTransparency = 0
    highlight.Parent = npc
    return highlight
end

local function createBillboard(npc)
    local rootPart = npc:FindFirstChild("HumanoidRootPart") or 
                    npc:FindFirstChild("Head") or 
                    npc.PrimaryPart
    
    if not rootPart then
        warn("找不到NPC的根部位:".. npc.Name)
        return nil
    end
    
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "NPC标记"
    billboard.AlwaysOnTop = true
    billboard.Size = UDim2.new(8, 0, 2.5, 0) 
    billboard.StudsOffset = Vector3.new(0, 3, 0)  
    billboard.Adornee = rootPart
    billboard.Parent = npc
    
    billboard:SetAttribute("BaseSize", UDim2.new(8, 0, 2.5, 0))
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = Color3.new(0, 0, 0)
    frame.BackgroundTransparency = 0.5
    frame.Parent = billboard
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0.1, 0)
    corner.Parent = frame
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "名称"
    nameLabel.Size = UDim2.new(1, -10, 0.4, 0)
    nameLabel.Position = UDim2.new(0, 5, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = npc.Name
    nameLabel.TextColor3 = Color3.new(1, 1, 1)
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = 16
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = frame
    
    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Name = "距离"
    distanceLabel.Size = UDim2.new(0.5, -5, 0.4, 0)
    distanceLabel.Position = UDim2.new(0, 5, 0.4, 0)
    distanceLabel.BackgroundTransparency = 1
    distanceLabel.Font = Enum.Font.Gotham
    distanceLabel.TextSize = 14
    distanceLabel.TextStrokeTransparency = 0
    distanceLabel.TextXAlignment = Enum.TextXAlignment.Left
    distanceLabel.Parent = frame
    
    local healthLabel = Instance.new("TextLabel")
    healthLabel.Name = "生命值"
    healthLabel.Size = UDim2.new(0.5, -5, 0.4, 0)
    healthLabel.Position = UDim2.new(0.5, 5, 0.4, 0)
    healthLabel.BackgroundTransparency = 1
    healthLabel.Font = Enum.Font.Gotham
    healthLabel.TextSize = 14
    healthLabel.TextStrokeTransparency = 0
    healthLabel.TextXAlignment = Enum.TextXAlignment.Right
    healthLabel.Parent = frame
    
    return billboard
end

local function updateBillboard(npc, billboard)
    local humanoid = npc:FindFirstChildOfClass("Humanoid")
    local playerRoot = getPlayerRoot()
    local rootPart = billboard.Adornee
    
    if not playerRoot or not rootPart then
        return
    end
    
    local distance = (playerRoot.Position - rootPart.Position).Magnitude
    
    local distanceLabel = billboard.Frame:FindFirstChild("距离")
    if distanceLabel then
        if distance < 20 then
            distanceLabel.TextColor3 = Color3.new(1, 0, 0)
        elseif distance < 50 then
            distanceLabel.TextColor3 = Color3.new(1, 1, 0)
        else
            distanceLabel.TextColor3 = Color3.new(0, 1, 0)
        end
        distanceLabel.Text = string.format("距离: %.1f米", distance)
    end
    
    local healthLabel = billboard.Frame:FindFirstChild("生命值")
    if healthLabel and humanoid then
        healthLabel.Text = string.format("生命: %d/%d", math.floor(humanoid.Health), math.floor(humanoid.MaxHealth))
    end
    
    local baseSize = billboard:GetAttribute("BaseSize") or UDim2.new(8, 0, 2.5, 0)
    local scale = 1
    
    if distance > 50 then
        scale = math.max(0.4, 1 - (distance - 50) / 200)
    end
    
    billboard.Size = UDim2.new(
        baseSize.X.Scale * scale,
        baseSize.X.Offset * scale,
        baseSize.Y.Scale * scale,
        baseSize.Y.Offset * scale
    )
end

local function clearTrackedNPCs()
    for _, billboard in pairs(npcBillboards) do
        if billboard and billboard.Parent then
            billboard:Destroy()
        end
    end
    
    for _, highlight in pairs(npcHighlights) do
        if highlight and highlight.Parent then
            highlight:Destroy()
        end
    end
    
    trackedNPCs = {}
    npcBillboards = {}
    npcHighlights = {}
end

local function trackNPCs()
    clearTrackedNPCs()
    
    local npcs = findNPCs()
    
    for _, npc in ipairs(npcs) do
        local humanoid = npc:FindFirstChildOfClass("Humanoid")
        local rootPart = npc:FindFirstChild("HumanoidRootPart") or npc:FindFirstChild("Head") or npc.PrimaryPart
        
        if humanoid and rootPart then
            trackedNPCs[npc] = true
            
            local billboard = createBillboard(npc)
            if billboard then
                npcBillboards[npc] = billboard
            end
            
            if isHighlightEnabled then
                local highlight = createHighlight(npc)
                npcHighlights[npc] = highlight
            end
        end
    end
end

local function toggleSwitch(button, innerFrame, state)
    if state then
        TweenService:Create(innerFrame, TweenInfo.new(0.2), {Position = UDim2.new(0.55, 0, 0.1, 0), BackgroundColor3 = Color3.fromRGB(60, 200, 80)}):Play()
    else
        TweenService:Create(innerFrame, TweenInfo.new(0.2), {Position = UDim2.new(0.05, 0, 0.1, 0), BackgroundColor3 = Color3.fromRGB(200, 60, 60)}):Play()
    end
end

local function startDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDragging = true
        dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
        frameStartPos = mainFrame.Position
    end
end

local function updateDrag(input)
    if isDragging then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
        mainFrame.Position = UDim2.new(
            frameStartPos.X.Scale, 
            frameStartPos.X.Offset + delta.X,
            frameStartPos.Y.Scale,
            frameStartPos.Y.Offset + delta.Y
        )
    end
end

local function stopDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDragging = false
    end
end

titleBar.InputBegan:Connect(startDrag)
titleBar.InputChanged:Connect(updateDrag)
UserInputService.InputEnded:Connect(stopDrag)

closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

toggleBtn.MouseButton1Click:Connect(function()
    isWindowVisible = not isWindowVisible
    
    if isWindowVisible then
        mainFrame.Visible = true
        toggleBtn.Text = "<"
        
        if isTrackerEnabled then
            for npc, billboard in pairs(npcBillboards) do
                if billboard and billboard.Parent then
                    updateBillboard(npc, billboard)
                end
            end
        end
    else
        mainFrame.Visible = false
        toggleBtn.Text = ">"
    end
end)

trackerToggle.MouseButton1Click:Connect(function()
    isTrackerEnabled = not isTrackerEnabled
    toggleSwitch(trackerToggle, trackerToggleInner, isTrackerEnabled)
    
    if not isTrackerEnabled then
        clearTrackedNPCs()
        if updateConn then
            updateConn:Disconnect()
            updateConn = nil
        end
    else
        trackNPCs()
        startUpdateLoop()
    end
end)

highlightToggle.MouseButton1Click:Connect(function()
    isHighlightEnabled = not isHighlightEnabled
    toggleSwitch(highlightToggle, highlightToggleInner, isHighlightEnabled)
    
    if isTrackerEnabled then
        for npc, _ in pairs(trackedNPCs) do
            if npcHighlights[npc] and npcHighlights[npc].Parent then
                npcHighlights[npc]:Destroy()
            end
            
            if isHighlightEnabled then
                npcHighlights[npc] = createHighlight(npc)
            end
        end
    end
end)

refreshButton.MouseButton1Click:Connect(function()
    if isTrackerEnabled then
        trackNPCs()
    end
end)

toggleSwitch(trackerToggle, trackerToggleInner, isTrackerEnabled)
toggleSwitch(highlightToggle, highlightToggleInner, isHighlightEnabled)

local function updateTrackedNPCs()
    local playerRoot = getPlayerRoot()
    if not playerRoot then return end
    
    for npc, _ in pairs(trackedNPCs) do
        if not npc:IsDescendantOf(workspace) then
            if npcBillboards[npc] then 
                npcBillboards[npc]:Destroy()
                npcBillboards[npc] = nil
            end
            if npcHighlights[npc] then 
                npcHighlights[npc]:Destroy()
                npcHighlights[npc] = nil
            end
            trackedNPCs[npc] = nil
        end
    end
    
    for npc, _ in pairs(trackedNPCs) do
        if npcBillboards[npc] and npcBillboards[npc].Parent and npcBillboards[npc].Adornee then
            updateBillboard(npc, npcBillboards[npc])
        else
            if npc:IsDescendantOf(workspace) then
                npcBillboards[npc] = createBillboard(npc)
            end
        end
    end
end

local function startUpdateLoop()
    if updateConn then
        updateConn:Disconnect()
    end
    
    updateConn = RunService.Heartbeat:Connect(updateTrackedNPCs)
end

if isTrackerEnabled then
    trackNPCs()
    startUpdateLoop()
end

workspace.DescendantAdded:Connect(function(descendant)
    if isNPC(descendant) and isTrackerEnabled then
        trackNPCs()
    end
end)
    end
})

ToolSection:Button({
    Title = "动态模糊",
    Desc = "根据移动速度动态调整模糊效果",
    Callback = function()
        local Lighting = game:GetService("Lighting")
        
        local motionBlur = Instance.new("BlurEffect")
        motionBlur.Name = "DynamicMotionBlur"
        motionBlur.Size = 10
        motionBlur.Parent = Lighting
        
        game:GetService("RunService").RenderStepped:Connect(function(deltaTime)
            local player = game:GetService("Players").LocalPlayer
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local velocity = player.Character.HumanoidRootPart.Velocity.Magnitude
                motionBlur.Size = math.clamp(velocity / 20, 0, 15)
            end
        end)
    end
})

ToolSection:Button({
    Title = "汉化穿墙",
    Desc = "穿墙功能",
    Icon = "move",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/TtmScripter/OtherScript/main/Noclip"))()
    end
})

ToolSection:Button({
    Title = "飞檐走壁",
    Desc = "加载后无法取消效果",
    Icon = "geist:bug",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/zXk4Rq2r"))()
    end
})

ToolSection:Button({
    Title = "快速互动",
    Desc = "包括自动互动",
    Icon = "geist:bug",
    Callback = function()
    local Players = game:GetService("Players")
local ProximityPromptService = game:GetService("ProximityPromptService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

if not game:IsLoaded() then
    game.Loaded:Wait()
end

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "快速互动工具",
    Text = "加载中...",
    Duration = 3
})

local config = {
    fastClickEnabled = false,
    autoScanEnabled = false,
    scanInterval = 0.1,
    interactionDistance = 20,
    isUIVisible = true
}

local UIContainer = Instance.new("ScreenGui")
UIContainer.Name = "QuickInteractionUI"
UIContainer.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
UIContainer.ResetOnSpawn = false
UIContainer.IgnoreGuiInset = true

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainWindow"
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
MainFrame.BorderSizePixel = 0
MainFrame.Size = UDim2.new(0, 350, 0, 220)
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -110)
MainFrame.Active = true
MainFrame.Draggable = true

local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
TitleBar.BorderSizePixel = 0
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "Title"
TitleLabel.BackgroundTransparency = 1
TitleLabel.Size = UDim2.new(0.6, 0, 1, 0)
TitleLabel.Position = UDim2.new(0.1, 0, 0, 0)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
TitleLabel.TextScaled = true
TitleLabel.Text = "快速互动"
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

local FoldButton = Instance.new("TextButton")
FoldButton.Name = "FoldButton"
FoldButton.BackgroundTransparency = 1
FoldButton.Size = UDim2.new(0, 30, 0, 30)
FoldButton.Position = UDim2.new(1, -60, 0, 0)
FoldButton.Font = Enum.Font.GothamBold
FoldButton.Text = "_"
FoldButton.TextColor3 = Color3.fromRGB(200, 200, 255)
FoldButton.TextScaled = true
FoldButton.TextStrokeTransparency = 0.5
FoldButton.ZIndex = 2
FoldButton.Parent = TitleBar

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.BackgroundTransparency = 1
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 150, 150)
CloseButton.TextScaled = true
CloseButton.TextStrokeTransparency = 0.5
CloseButton.ZIndex = 2
CloseButton.Parent = TitleBar

local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "Content"
ContentFrame.BackgroundTransparency = 1
ContentFrame.Size = UDim2.new(1, -20, 1, -50)
ContentFrame.Position = UDim2.new(0, 10, 0, 40)
ContentFrame.Parent = MainFrame

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Padding = UDim.new(0, 10)
ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
ContentLayout.Parent = ContentFrame

local function createToggle(parent, name, callback)
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Name = "ToggleFrame"
    toggleFrame.BackgroundTransparency = 1
    toggleFrame.Size = UDim2.new(1, 0, 0, 40)
    toggleFrame.LayoutOrder = #parent:GetChildren()
    toggleFrame.Parent = parent

    local toggleLabel = Instance.new("TextLabel")
    toggleLabel.Name = "Label"
    toggleLabel.BackgroundTransparency = 1
    toggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
    toggleLabel.Font = Enum.Font.Gotham
    toggleLabel.Text = name
    toggleLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    toggleLabel.TextScaled = true
    toggleLabel.TextXAlignment = Enum.TextXAlignment.Left
    toggleLabel.Parent = toggleFrame

    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "Toggle"
    toggleButton.AnchorPoint = Vector2.new(0.5, 0.5)
    toggleButton.Position = UDim2.new(0.9, 0, 0.5, 0)
    toggleButton.Size = UDim2.new(0.2, 0, 0.7, 0)
    toggleButton.BackgroundColor3 = Color3.fromRGB(70, 70, 85)
    toggleButton.BorderSizePixel = 0
    toggleButton.Font = Enum.Font.GothamBold
    toggleButton.Text = "关闭"
    toggleButton.TextColor3 = Color3.fromRGB(255, 100, 100)
    toggleButton.TextScaled = true
    toggleButton.Parent = toggleFrame

    local state = false

    local function updateToggle()
        state = not state
        if state then
            toggleButton.BackgroundColor3 = Color3.fromRGB(60, 140, 70)
            toggleButton.Text = "开启"
            toggleButton.TextColor3 = Color3.fromRGB(220, 255, 220)
        else
            toggleButton.BackgroundColor3 = Color3.fromRGB(70, 70, 85)
            toggleButton.Text = "关闭"
            toggleButton.TextColor3 = Color3.fromRGB(255, 100, 100)
        end
        
        if callback then
            callback(state)
        end
    end
    
    toggleButton.MouseButton1Click:Connect(updateToggle)
    
    return toggleButton
end

local fastClickToggle = createToggle(ContentFrame, "快速点击互动", function(state)
    config.fastClickEnabled = state
    if state then
        getgenv().FastClickConnection = ProximityPromptService.PromptButtonHoldBegan:Connect(function(prompt)
            prompt.HoldDuration = 0
        end)
    else
        if getgenv().FastClickConnection then
            getgenv().FastClickConnection:Disconnect()
        end
    end
end)

local autoScanToggle = createToggle(ContentFrame, "自动扫描互动", function(state)
    config.autoScanEnabled = state
end)

task.spawn(function()
    while true do
        wait(config.scanInterval)
        
        if config.autoScanEnabled and LocalPlayer.Character then
            local humanoidRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            
            if humanoidRootPart then
                for _, prompt in pairs(ProximityPromptService:GetActivePrompts()) do
                    if prompt.Enabled and prompt:IsA("ProximityPrompt") then
                        local distance = (prompt.TriggerWorldPosition - humanoidRootPart.Position).Magnitude
                        
                        if distance <= math.min(config.interactionDistance, prompt.MaxActivationDistance) then
                            prompt:InputHoldBegin()
                            wait(0.05)
                            prompt:InputHoldEnd()
                        end
                    end
                end
            end
        end
    end
end)

FoldButton.MouseButton1Click:Connect(function()
    config.isUIVisible = not config.isUIVisible
    
    if config.isUIVisible then
        ContentFrame.Visible = true
        FoldButton.Text = "_"
        MainFrame.Size = UDim2.new(0, 350, 0, 220)
    else
        ContentFrame.Visible = false
        FoldButton.Text = "+"
        MainFrame.Size = UDim2.new(0, 350, 0, 30)
    end
end)

MainFrame.Parent = UIContainer
UIContainer.Parent = PlayerGui

CloseButton.MouseButton1Click:Connect(function()
    UIContainer:Destroy()
    
    if getgenv().FastClickConnection then
        getgenv().FastClickConnection:Disconnect()
    end
    
    config.fastClickEnabled = false
    config.autoScanEnabled = false
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "快速互动工具",
        Text = "已关闭",
        Duration = 3
    })
end)

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "快速互动工具",
    Text = "已成功加载!\n快速互动工具已激活",
    Duration = 5
})

    end
})

local autoInteract = false
local autoInteractConnection
ToolSection:Toggle({
    Title = "自动互动",
    Desc = "Auto Interact",
    Default = false,
    Callback = function(state)
        autoInteract = state
        if state then
            autoInteractConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if not autoInteract then
                    autoInteractConnection:Disconnect()
                    return
                end
                for _, descendant in pairs(workspace:GetDescendants()) do
                    if descendant:IsA("ProximityPrompt") then
                        fireproximityprompt(descendant)
                    end
                end
            end)
        else
            if autoInteractConnection then
                autoInteractConnection:Disconnect()
            end
        end
    end
})

ToolSection:Button({
    Title = "工具挂",
    Desc = "加载工具挂脚本",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Bebo-Mods/BeboScripts/main/StandAwekening.lua", true))()
    end
})

ToolSection:Button({
    Title = "点击传送工具",
    Desc = "生成点击传送工具",
    Callback = function()
        local mouse = game.Players.LocalPlayer:GetMouse()
        local tool = Instance.new("Tool")
        tool.RequiresHandle = false
        tool.Name = "MT点击传送"
        tool.Activated:Connect(function()
            if game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local pos = mouse.Hit + Vector3.new(0, 2.5, 0)
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(pos.X, pos.Y, pos.Z)
            end
        end)
        tool.Parent = game.Players.LocalPlayer.Backpack
    end
})

ToolSection:Button({
    Title = "电脑键盘",
    Desc = "加载虚拟键盘功能",
    Icon = "keyboard",
    Callback = function()
        WindUI:Notify({
            Title = "正在加载",
            Content = "加载虚拟键盘中...",
            Duration = 1,
            Icon = "download"
        })
        
        local success, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/advxzivhsjjdhxhsidifvsh/mobkeyboard/main/main.txt", true))()
        end)
        
        if success then
            WindUI:Notify({
                Title = "加载成功",
                Content = "虚拟键盘已加载完成",
                Duration = 3,
                Icon = "check-circle"
            })
        else
            WindUI:Notify({
                Title = "加载失败",
                Content = "虚拟键盘加载失败: " .. tostring(err),
                Duration = 5,
                Icon = "alert-circle"
            })
        end
    end
})

ToolSection:Button({
    Title = "反挂机",
    Desc = "加载反挂机脚本",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/9fFu43FF"))()
        
        WindUI:Notify({
            Title = "反挂机脚本",
            Content = "正在加载反挂机功能...",
            Duration = 3,
            Icon = "shield"
        })
    end
})

local godModeEnabled = false
local connection = nil

ToolSection:Toggle({
    Title = "无敌模式(无限回血)",
    Desc = "反作弊差的服务器有效",
    Default = false,
    Callback = function(state)
        godModeEnabled = state
        
        if connection then
            connection:Disconnect()
        end
        
        if state then
            local lastUpdate = 0
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                if not godModeEnabled then
                    connection:Disconnect()
                    return
                end
                
                if tick() - lastUpdate >= 0.1 then
                    local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        humanoid.Health = math.huge
                        humanoid.MaxHealth = math.huge
                    end
                    lastUpdate = tick()
                end
            end)
        end
    end
})

local airWalkEnabled = false
local bodyPositionInstance = nil

ToolSection:Toggle({
    Title = "空中行走",
    Desc = "固定Y轴位置，不会掉落",
    Default = false,
    Callback = function(state)
        airWalkEnabled = state
        
        if state then
            
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local hrp = character.HumanoidRootPart
                bodyPositionInstance = Instance.new("BodyPosition")
                bodyPositionInstance.Position = Vector3.new(0, hrp.Position.Y, 0)
                bodyPositionInstance.MaxForce = Vector3.new(0, 40000, 0)
                bodyPositionInstance.P = 10000
                bodyPositionInstance.Parent = hrp
                
                game.Players.LocalPlayer.CharacterAdded:Connect(function(newChar)
                    wait(1)
                    if airWalkEnabled and newChar:FindFirstChild("HumanoidRootPart") then
                        bodyPositionInstance = Instance.new("BodyPosition")
                        bodyPositionInstance.Position = Vector3.new(0, newChar.HumanoidRootPart.Position.Y, 0)
                        bodyPositionInstance.MaxForce = Vector3.new(0, 40000, 0)
                        bodyPositionInstance.Parent = newChar.HumanoidRootPart
                    end
                end)
            end
            WindUI:Notify({Title = "空中行走已启用", Content = "Y轴位置已固定", Duration = 2})
        else
            if bodyPositionInstance then
                bodyPositionInstance:Destroy()
                bodyPositionInstance = nil
            end
            WindUI:Notify({Title = "空中行走已禁用", Content = "可以正常掉落", Duration = 2})
        end
    end
})

local infiniteJump = false
ToolSection:Toggle({
    Title = "无限跳",
    Desc = "Toggle",
    Default = false,
    Callback = function(Value)
        infiniteJump = Value
    end
})

game:GetService("UserInputService").JumpRequest:Connect(function()
    if infiniteJump and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        game.Players.LocalPlayer.Character.Humanoid:ChangeState("Jumping")
    end
end)

ToolSection:Button({
    Title = "聊天记录",
    Desc = "加载聊天几句脚本",
    Callback = function()
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextService = game:GetService("TextService")
local TweenService = game:GetService("TweenService")
local StarterGui = game:GetService("StarterGui")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local ChatUI = Instance.new("ScreenGui")
ChatUI.Name = "GaoHubChatUI"
ChatUI.ResetOnSpawn = false
ChatUI.Parent = PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0.3, 0, 0.5, 0)
MainFrame.Position = UDim2.new(0.35, 0, 0.25, 0) 
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BackgroundTransparency = 0.3
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0.03, 0)
UICorner.Parent = MainFrame

MainFrame.Parent = ChatUI

local HideButton = Instance.new("TextButton")
HideButton.Name = "HideButton"
HideButton.Size = UDim2.new(0.05, 0, 0.08, 0)
HideButton.Position = UDim2.new(0.01, 0, 0.25, 0)
HideButton.AnchorPoint = Vector2.new(0, 0.5)
HideButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
HideButton.Text = ">"
HideButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HideButton.Font = Enum.Font.SourceSansBold
HideButton.TextSize = 18
HideButton.Parent = ChatUI

local HideButtonCorner = Instance.new("UICorner")
HideButtonCorner.CornerRadius = UDim.new(0.03, 0)
HideButtonCorner.Parent = HideButton

local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0.08, 0)
TitleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleText = Instance.new("TextLabel")
TitleText.Name = "TitleText"
TitleText.Size = UDim2.new(0.7, 0, 1, 0)
TitleText.Position = UDim2.new(0.15, 0, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "Gao Hub 聊天记录器"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.Font = Enum.Font.SourceSansBold
TitleText.TextSize = 18
TitleText.Parent = TitleBar

local ChatScroller = Instance.new("ScrollingFrame")
ChatScroller.Name = "ChatScroller"
ChatScroller.Size = UDim2.new(1, -10, 0.7, -10)
ChatScroller.Position = UDim2.new(0, 5, 0.08, 5)
ChatScroller.BackgroundTransparency = 1
ChatScroller.BorderSizePixel = 0
ChatScroller.ScrollBarThickness = 5
ChatScroller.AutomaticCanvasSize = Enum.AutomaticSize.Y
ChatScroller.CanvasSize = UDim2.new(0, 0, 0, 0)
ChatScroller.ScrollingDirection = Enum.ScrollingDirection.Y
ChatScroller.Parent = MainFrame

local ChatLayout = Instance.new("UIListLayout")
ChatLayout.Name = "ChatLayout"
ChatLayout.Padding = UDim.new(0, 10)
ChatLayout.SortOrder = Enum.SortOrder.LayoutOrder
ChatLayout.Parent = ChatScroller

local ControlPanel = Instance.new("Frame")
ControlPanel.Name = "ControlPanel"
ControlPanel.Size = UDim2.new(1, -10, 0.12, 0)
ControlPanel.Position = UDim2.new(0, 5, 0.8, 0)
ControlPanel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ControlPanel.BorderSizePixel = 0
ControlPanel.Parent = MainFrame

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0.4, 0, 0.7, 0)
CloseButton.Position = UDim2.new(0.05, 0, 0.15, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(215, 60, 0)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "关闭"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.TextSize = 16
CloseButton.Parent = ControlPanel

local NotifyButton = Instance.new("TextButton")
NotifyButton.Name = "NotifyButton"
NotifyButton.Size = UDim2.new(0.4, 0, 0.7, 0)
NotifyButton.Position = UDim2.new(0.55, 0, 0.15, 0)
NotifyButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
NotifyButton.BorderSizePixel = 0
NotifyButton.Text = "通知: 开"
NotifyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
NotifyButton.Font = Enum.Font.SourceSansBold
NotifyButton.TextSize = 16
NotifyButton.Parent = ControlPanel

local SendPanel = Instance.new("Frame")
SendPanel.Name = "SendPanel"
SendPanel.Size = UDim2.new(0.25, 0, 0.5, 0)
SendPanel.Position = UDim2.new(0.7, 10, 0.25, 0)
SendPanel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
SendPanel.BackgroundTransparency = 0.3
SendPanel.BorderSizePixel = 0
SendPanel.Parent = ChatUI

local SendPanelCorner = Instance.new("UICorner")
SendPanelCorner.CornerRadius = UDim.new(0.03, 0)
SendPanelCorner.Parent = SendPanel

local SendTitle = Instance.new("TextLabel")
SendTitle.Name = "SendTitle"
SendTitle.Size = UDim2.new(1, 0, 0.1, 0)
SendTitle.BackgroundTransparency = 1
SendTitle.Text = "发送消息"
SendTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
SendTitle.Font = Enum.Font.SourceSansBold
SendTitle.TextSize = 18
SendTitle.Parent = SendPanel

local MessageInput = Instance.new("TextBox")
MessageInput.Name = "MessageInput"
MessageInput.Size = UDim2.new(0.9, 0, 0.6, 0)
MessageInput.Position = UDim2.new(0.05, 0, 0.15, 0)
MessageInput.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MessageInput.TextColor3 = Color3.fromRGB(255, 255, 255)
MessageInput.Font = Enum.Font.SourceSans
MessageInput.TextSize = 16
MessageInput.TextWrapped = true
MessageInput.PlaceholderText = "输入消息..."
MessageInput.ClearTextOnFocus = false
MessageInput.Text = ""
MessageInput.Parent = SendPanel

local SendButton = Instance.new("TextButton")
SendButton.Name = "SendButton"
SendButton.Size = UDim2.new(0.9, 0, 0.2, 0)
SendButton.Position = UDim2.new(0.05, 0, 0.8, 0)
SendButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
SendButton.BorderSizePixel = 0
SendButton.Text = "发送"
SendButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SendButton.Font = Enum.Font.SourceSansBold
SendButton.TextSize = 16
SendButton.Parent = SendPanel

local isChatEnabled = true
local isVisible = true
local notificationsEnabled = true
local soundId = "rbxassetid://2865227271"
local isDragging = false
local isHideButtonDragging = false
local dragStartPos, frameStartPos, hideButtonStartPos
local activeNotifications = {}

local sound = Instance.new("Sound")
sound.SoundId = soundId
sound.Parent = ChatUI

local avatarCache = {}
local displayNameCache = {}

local function GetPlayerDisplayName(userId)
    if displayNameCache[userId] then
        return displayNameCache[userId]
    end
    
    local player = Players:GetPlayerByUserId(userId)
    if player then
        displayNameCache[userId] = player.DisplayName
        return player.DisplayName
    end
    return ""
end

local function GetPlayerAvatar(userId)
    if avatarCache[userId] then
        return avatarCache[userId]
    end
    
    local success, result = pcall(function()
        return Players:GetUserThumbnailAsync(userId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
    end)
    
    if success then
        avatarCache[userId] = result
        return result
    else
        return "rbxassetid://0"
    end
end

local function AnimateButton(button)
    local originalSize = button.Size
    local originalPos = button.Position
    
    local scaleUp = TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = originalSize * 1.05,
        Position = originalPos - UDim2.new(0.025, 0, 0.025, 0)
    })
    
    local scaleDown = TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = originalSize,
        Position = originalPos
    })
    
    scaleUp:Play()
    scaleUp.Completed:Connect(function()
        scaleDown:Play()
    end)
end

for _, button in pairs({CloseButton, NotifyButton, SendButton, HideButton}) do
    button.MouseButton1Click:Connect(function()
        AnimateButton(button)
    end)
end

local function StartDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = true
        dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
        frameStartPos = Vector2.new(MainFrame.Position.X.Offset, MainFrame.Position.Y.Offset)
        
        local dragConnection
        dragConnection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                isDragging = false
                dragConnection:Disconnect()
            end
        end)
    end
end

local function UpdateDrag(input)
    if isDragging then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
        local newPos = frameStartPos + delta
        
        local viewportSize = workspace.CurrentCamera.ViewportSize
        local frameSize = MainFrame.AbsoluteSize
        
        newPos = Vector2.new(
            math.clamp(newPos.X, 0, viewportSize.X - frameSize.X),
            math.clamp(newPos.Y, 0, viewportSize.Y - frameSize.Y)
        )
        
        MainFrame.Position = UDim2.new(0, newPos.X, 0, newPos.Y)
    end
end

local function StartHideButtonDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isHideButtonDragging = true
        dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
        hideButtonStartPos = Vector2.new(HideButton.Position.X.Offset, HideButton.Position.Y.Offset)
        
        local dragConnection
        dragConnection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                isHideButtonDragging = false
                dragConnection:Disconnect()
            end
        end)
    end
end

local function UpdateHideButtonDrag(input)
    if isHideButtonDragging then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
        local newPos = hideButtonStartPos + delta
        
        local viewportSize = workspace.CurrentCamera.ViewportSize
        local buttonSize = HideButton.AbsoluteSize
        
        newPos = Vector2.new(
            math.clamp(newPos.X, 0, viewportSize.X - buttonSize.X),
            math.clamp(newPos.Y, 0, viewportSize.Y - buttonSize.Y)
        )
        
        HideButton.Position = UDim2.new(0, newPos.X, 0, newPos.Y)
    end
end

TitleBar.InputBegan:Connect(StartDrag)
HideButton.InputBegan:Connect(StartHideButtonDrag)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        UpdateDrag(input)
        UpdateHideButtonDrag(input)
    end
end)

local function ToggleVisibility()
    isVisible = not isVisible
    
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)
    
    if isVisible then
        HideButton.Text = ">"
        local tweenMain = TweenService:Create(MainFrame, tweenInfo, {
            BackgroundTransparency = 0.3,
            Size = UDim2.new(0.3, 0, 0.5, 0)
        })
        local tweenSend = TweenService:Create(SendPanel, tweenInfo, {
            BackgroundTransparency = 0.3,
            Size = UDim2.new(0.25, 0, 0.5, 0)
        })
        tweenMain:Play()
        tweenSend:Play()
        ChatScroller.Visible = true
        ControlPanel.Visible = true
        TitleText.Visible = true
        SendPanel.Visible = true
    else
        HideButton.Text = "<"
        local tweenMain = TweenService:Create(MainFrame, tweenInfo, {
            BackgroundTransparency = 1,
            Size = UDim2.new(0.05, 0, 0.08, 0)
        })
        local tweenSend = TweenService:Create(SendPanel, tweenInfo, {
            BackgroundTransparency = 1,
            Size = UDim2.new(0.05, 0, 0.08, 0)
        })
        tweenMain:Play()
        tweenSend:Play()
        ChatScroller.Visible = false
        ControlPanel.Visible = false
        TitleText.Visible = false
        SendPanel.Visible = false
    end
end

HideButton.MouseButton1Click:Connect(function()
    if not isHideButtonDragging then
        ToggleVisibility()
    end
end)

local function AddMessageToChat(playerName, message, playerUserId)
    local displayName = GetPlayerDisplayName(playerUserId)
    local nameWithDisplay = playerName
    if displayName ~= "" and displayName ~= playerName then
        nameWithDisplay = playerName .. " (" .. displayName .. ")"
    end
    
    local messageFrame = Instance.new("Frame")
    messageFrame.Name = "MessageFrame"
    messageFrame.Size = UDim2.new(1, -10, 0, 0)
    messageFrame.AutomaticSize = Enum.AutomaticSize.Y
    messageFrame.BackgroundTransparency = 1
    messageFrame.LayoutOrder = #ChatScroller:GetChildren()
    messageFrame.Parent = ChatScroller
    
    local avatar = GetPlayerAvatar(playerUserId)
    
    local avatarImage = Instance.new("ImageLabel")
    avatarImage.Name = "Avatar"
    avatarImage.Size = UDim2.new(0.1, 0, 0.1, 0)
    avatarImage.Position = UDim2.new(0, 0, 0, 0)
    avatarImage.BackgroundTransparency = 1
    avatarImage.Image = avatar
    avatarImage.Parent = messageFrame
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    nameLabel.Size = UDim2.new(0.8, 0, 0.1, 0)
    nameLabel.Position = UDim2.new(0.12, 0, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = nameWithDisplay
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextSize = 14
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = messageFrame
    
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Name = "MessageLabel"
    messageLabel.Size = UDim2.new(0.8, 0, 0, 0)
    messageLabel.Position = UDim2.new(0.12, 0, 0.1, 0)
    messageLabel.BackgroundTransparency = 1
    messageLabel.Text = message
    messageLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    messageLabel.Font = Enum.Font.SourceSans
    messageLabel.TextSize = 14
    messageLabel.TextXAlignment = Enum.TextXAlignment.Left
    messageLabel.TextYAlignment = Enum.TextYAlignment.Top
    messageLabel.TextWrapped = true
    messageLabel.AutomaticSize = Enum.AutomaticSize.Y
    messageLabel.Parent = messageFrame
    
    local function UpdateChatSize()
        local totalHeight = 0
        for _, child in ipairs(ChatScroller:GetChildren()) do
            if child:IsA("Frame") then
                totalHeight = totalHeight + child.AbsoluteSize.Y + ChatLayout.Padding.Offset
            end
        end
        
        local maxHeight = workspace.CurrentCamera.ViewportSize.Y * 0.7
        ChatScroller.CanvasSize = UDim2.new(0, 0, 0, math.min(totalHeight, maxHeight))
        
        task.wait()
        ChatScroller.CanvasPosition = Vector2.new(0, ChatScroller.AbsoluteCanvasSize.Y)
    end
    
    messageLabel:GetPropertyChangedSignal("AbsoluteSize"):Connect(UpdateChatSize)
    UpdateChatSize()
end

local function RequestClose()
    StarterGui:SetCore("SendNotification", {
        Title = "关闭聊天界面",
        Text = "是否要关闭Gao Hub聊天记录器? (12秒后自动取消)",
        Duration = 12,
        Button1 = "是",
        Button2 = "否",
        Callback = function(choice)
            if choice == 1 then
                ChatUI:Destroy()
                SendPanel:Destroy()
                
                for notifGui, _ in pairs(activeNotifications) do
                    notifGui:Destroy()
                end
            end
        end
    })
    
    sound:Play()
end

CloseButton.MouseButton1Click:Connect(RequestClose)

local function ToggleNotifications()
    notificationsEnabled = not notificationsEnabled
    
    if notificationsEnabled then
        NotifyButton.Text = "通知: 开"
        NotifyButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    else
        NotifyButton.Text = "通知: 关"
        NotifyButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    end
end

NotifyButton.MouseButton1Click:Connect(ToggleNotifications)

local function ShowAvatarNotification(playerName, message, playerUserId)
    if not notificationsEnabled then return end
    
    local displayName = GetPlayerDisplayName(playerUserId)
    local nameWithDisplay = playerName
    if displayName ~= "" and displayName ~= playerName then
        nameWithDisplay = playerName .. " (" .. displayName .. ")"
    end
    
    local avatar = GetPlayerAvatar(playerUserId)
    
    local notificationGui = Instance.new("ScreenGui")
    notificationGui.Name = "ChatNotification_" .. playerUserId .. "_" .. tick()
    notificationGui.ResetOnSpawn = false
    notificationGui.Parent = PlayerGui
    
    local notificationFrame = Instance.new("Frame")
    notificationFrame.Name = "NotificationFrame"
    notificationFrame.Size = UDim2.new(0.3, 0, 0.1, 0)
    
    local yOffset = 0
    for _, notif in pairs(activeNotifications) do
        yOffset = yOffset + notif.Size.Y.Offset + 5
    end
    notificationFrame.Position = UDim2.new(0.35, 0, 0, yOffset + 5)
    
    notificationFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    notificationFrame.BackgroundTransparency = 0.2
    notificationFrame.BorderSizePixel = 0
    notificationFrame.Parent = notificationGui
    
    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0.03, 0)
    notifCorner.Parent = notificationFrame
    
    local avatarImage = Instance.new("ImageLabel")
    avatarImage.Name = "Avatar"
    avatarImage.Size = UDim2.new(0.15, 0, 0.8, 0)
    avatarImage.Position = UDim2.new(0.02, 0, 0.1, 0)
    avatarImage.BackgroundTransparency = 1
    avatarImage.Image = avatar
    avatarImage.Parent = notificationFrame
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    nameLabel.Size = UDim2.new(0.6, 0, 0.3, 0)
    nameLabel.Position = UDim2.new(0.2, 0, 0.1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = nameWithDisplay
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextSize = 14
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = notificationFrame
    
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Name = "MessageLabel"
    messageLabel.Size = UDim2.new(0.75, 0, 0.5, 0)
    messageLabel.Position = UDim2.new(0.2, 0, 0.4, 0)
    messageLabel.BackgroundTransparency = 1
    messageLabel.Text = message
    messageLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    messageLabel.Font = Enum.Font.SourceSans
    messageLabel.TextSize = 14
    messageLabel.TextXAlignment = Enum.TextXAlignment.Left
    messageLabel.TextYAlignment = Enum.TextYAlignment.Top
    messageLabel.TextWrapped = true
    messageLabel.Parent = notificationFrame
    
    local progressBarBg = Instance.new("Frame")
    progressBarBg.Name = "ProgressBarBg"
    progressBarBg.Size = UDim2.new(1, 0, 0.05, 0)
    progressBarBg.Position = UDim2.new(0, 0, 0.95, 0)
    progressBarBg.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    progressBarBg.BorderSizePixel = 0
    progressBarBg.Parent = notificationFrame
    
    local progressBar = Instance.new("Frame")
    progressBar.Name = "ProgressBar"
    progressBar.Size = UDim2.new(1, 0, 1, 0)
    progressBar.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    progressBar.BorderSizePixel = 0
    progressBar.Parent = progressBarBg
    
    activeNotifications[notificationGui] = notificationFrame
    
    sound:Play()
    
    local duration = 5
    local startTime = tick()
    
    local connection
    connection = RunService.Heartbeat:Connect(function()
        local elapsed = tick() - startTime
        local progress = 1 - (elapsed / duration)
        
        if progress <= 0 then
            connection:Disconnect()
            notificationGui:Destroy()
            activeNotifications[notificationGui] = nil
        else
            progressBar.Size = UDim2.new(progress, 0, 1, 0)
        end
    end)
end

local function SendMessage()
    local message = MessageInput.Text
    if message == "" then return end
    
    local success, errorMsg = pcall(function()
        game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(message, "All")
        
        if not success then
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.OnMessageDoneFiltering.OnClientEvent:Wait()
            LocalPlayer.Chatted:Fire(message)
        end
        
        AddMessageToChat(LocalPlayer.Name, message, LocalPlayer.UserId)
        MessageInput.Text = ""
    end)
    
    if not success then
        warn("官方聊天系统发送失败:", errorMsg)
        
        pcall(function()
            LocalPlayer.Chatted:Fire(message)
            AddMessageToChat(LocalPlayer.Name, message, LocalPlayer.UserId)
            MessageInput.Text = ""
        end)
    end
end

SendButton.MouseButton1Click:Connect(SendMessage)

MessageInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        SendMessage()
    end
end)

local function OnChatMessage(message, speaker)
    AddMessageToChat(speaker.Name, message, speaker.UserId)
    
    ShowAvatarNotification(speaker.Name, message, speaker.UserId)
end

local function SetupPlayerChat(player)
    player.Chatted:Connect(function(message)
        OnChatMessage(message, player)
    end)
end

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        SetupPlayerChat(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    SetupPlayerChat(player)
end)


if UserInputService.TouchEnabled then

    CloseButton.Size = UDim2.new(0.4, 0, 0.8, 0)
    NotifyButton.Size = UDim2.new(0.4, 0, 0.8, 0)
    SendButton.Size = UDim2.new(0.9, 0, 0.25, 0)
    HideButton.Size = UDim2.new(0.08, 0, 0.12, 0)

    CloseButton.TextSize = 18
    NotifyButton.TextSize = 18
    SendButton.TextSize = 18
    MessageInput.TextSize = 18
    HideButton.TextSize = 20
    
    ChatScroller.ChildAdded:Connect(function(child)
        if child:IsA("Frame") and child:FindFirstChild("MessageLabel") then
            child.MessageLabel.TextSize = 16
            child.NameLabel.TextSize = 16
        end
    end)
end
    end
})

ToolSection:Button({
    Title = "坐标",
    Desc = "加载坐标脚本",
    Callback = function()
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CoordinateSidebar"
ScreenGui.Parent = player.PlayerGui

local Sidebar = Instance.new("Frame")
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0.2, 0, 1, 0)
Sidebar.Position = UDim2.new(-0.2, 0, 0, 0) 
Sidebar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Sidebar.BorderSizePixel = 0
Sidebar.ClipsDescendants = true
Sidebar.Parent = ScreenGui

local Content = Instance.new("Frame")
Content.Name = "Content"
Content.Size = UDim2.new(1, 0, 1, 0)
Content.BackgroundTransparency = 1
Content.Parent = Sidebar

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -20, 0, 30)
Title.Position = UDim2.new(0, 10, 0, 10)
Title.BackgroundTransparency = 1
Title.Text = "坐标工具"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Content

local CurrentPositionLabel = Instance.new("TextLabel")
CurrentPositionLabel.Name = "CurrentPositionLabel"
CurrentPositionLabel.Size = UDim2.new(1, -20, 0, 20)
CurrentPositionLabel.Position = UDim2.new(0, 10, 0, 50)
CurrentPositionLabel.BackgroundTransparency = 1
CurrentPositionLabel.Text = "当前位置: 未获取"
CurrentPositionLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
CurrentPositionLabel.Font = Enum.Font.SourceSans
CurrentPositionLabel.TextSize = 16
CurrentPositionLabel.TextXAlignment = Enum.TextXAlignment.Left
CurrentPositionLabel.Parent = Content

local GetPositionButton = Instance.new("TextButton")
GetPositionButton.Name = "GetPositionButton"
GetPositionButton.Size = UDim2.new(1, -20, 0, 30)
GetPositionButton.Position = UDim2.new(0, 10, 0, 80)
GetPositionButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
GetPositionButton.BorderSizePixel = 0
GetPositionButton.Text = "获取当前位置并复制"
GetPositionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
GetPositionButton.Font = Enum.Font.SourceSans
GetPositionButton.TextSize = 16
GetPositionButton.Parent = Content

local CoordinateInput = Instance.new("TextBox")
CoordinateInput.Name = "CoordinateInput"
CoordinateInput.Size = UDim2.new(1, -20, 0, 30)
CoordinateInput.Position = UDim2.new(0, 10, 0, 120)
CoordinateInput.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
CoordinateInput.BorderSizePixel = 0
CoordinateInput.PlaceholderText = "输入坐标 (X, Y, Z)"
CoordinateInput.Text = ""
CoordinateInput.TextColor3 = Color3.fromRGB(255, 255, 255)
CoordinateInput.Font = Enum.Font.SourceSans
CoordinateInput.TextSize = 16
CoordinateInput.TextXAlignment = Enum.TextXAlignment.Left
CoordinateInput.Parent = Content

local TeleportButton = Instance.new("TextButton")
TeleportButton.Name = "TeleportButton"
TeleportButton.Size = UDim2.new(1, -20, 0, 30)
TeleportButton.Position = UDim2.new(0, 10, 0, 160)
TeleportButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
TeleportButton.BorderSizePixel = 0
TeleportButton.Text = "传送到坐标"
TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportButton.Font = Enum.Font.SourceSans
TeleportButton.TextSize = 16
TeleportButton.Parent = Content

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0.5, -15)
CloseButton.AnchorPoint = Vector2.new(0, 0.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "<"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.TextSize = 20
CloseButton.Parent = Sidebar

local OpenButton = Instance.new("TextButton")
OpenButton.Name = "OpenButton"
OpenButton.Size = UDim2.new(0, 30, 0, 60)
OpenButton.Position = UDim2.new(0, 0, 0.5, -30)
OpenButton.AnchorPoint = Vector2.new(0, 0.5)
OpenButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
OpenButton.BorderSizePixel = 0
OpenButton.Text = ">"
OpenButton.TextColor3 = Color3.fromRGB(255, 255, 255)
OpenButton.Font = Enum.Font.SourceSansBold
OpenButton.TextSize = 20
OpenButton.Visible = false
OpenButton.Parent = ScreenGui

local function ToggleSidebar(show)
    if show then
        local tweenIn = TweenService:Create(
            Sidebar,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Position = UDim2.new(0, 0, 0, 0)}
        )
        tweenIn:Play()
        OpenButton.Visible = false
    else
        local tweenOut = TweenService:Create(
            Sidebar,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Position = UDim2.new(-0.2, 0, 0, 0)}
        )
        tweenOut:Play()
        OpenButton.Visible = true
    end
end

ToggleSidebar(true)

GetPositionButton.MouseButton1Click:Connect(function()
    if humanoidRootPart then
        local position = humanoidRootPart.Position
        local positionText = string.format("(%d, %d, %d)", math.floor(position.X), math.floor(position.Y), math.floor(position.Z))
        CurrentPositionLabel.Text = "当前位置: " .. positionText
        
        setclipboard(positionText)
        
        local originalText = GetPositionButton.Text
        GetPositionButton.Text = "已复制!"
        wait(1)
        GetPositionButton.Text = originalText
    end
end)

TeleportButton.MouseButton1Click:Connect(function()
    local text = CoordinateInput.Text
    local x, y, z = text:match("%(?%s*(%-?%d+%.?%d*)%s*,%s*(%-?%d+%.?%d*)%s*,%s*(%-?%d+%.?%d*)%s*%)?")
    
    if x and y and z then
        x, y, z = tonumber(x), tonumber(y), tonumber(z)
        if humanoidRootPart then
            humanoidRootPart.CFrame = CFrame.new(Vector3.new(x, y, z))
            
            local originalText = TeleportButton.Text
            TeleportButton.Text = "已传送!"
            wait(1)
            TeleportButton.Text = originalText
        end
    else
        local originalText = TeleportButton.Text
        TeleportButton.Text = "格式错误!"
        wait(1)
        TeleportButton.Text = originalText
    end
end)

CloseButton.MouseButton1Click:Connect(function()
    ToggleSidebar(false)
end)

OpenButton.MouseButton1Click:Connect(function()
    ToggleSidebar(true)
end)

player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoidRootPart = newCharacter:WaitForChild("HumanoidRootPart")
end)
        
        WindUI:Notify({
            Title = "坐标脚本已加载",
            Content = "正在加载功能...",
            Duration = 3,
            Icon = "shield"
        })
    end
})

local ESPSettingsSection = thirdTab:Section({Title = "ESP设置", Opened = false, Icon="lucide:tags"}) 

ESPSettingsSection:Toggle({
    Title = "显示追踪线",
    Desc = "启用/禁用追踪线",
    Default = true,
    Callback = function(Value)
        if ESPElements then
            for _, espElement in pairs(ESPElements) do
                if espElement and not espElement.Deleted and espElement.CurrentSettings and espElement.CurrentSettings.Tracer then
                    espElement.CurrentSettings.Tracer.Enabled = Value
                end
            end
        end
    end
})

ESPSettingsSection:Toggle({
    Title = "显示箭头",
    Desc = "启用/禁用方向箭头",
    Default = true,
    Callback = function(Value)
        if ESPElements then
            for _, espElement in pairs(ESPElements) do
                if espElement and not espElement.Deleted and espElement.CurrentSettings and espElement.CurrentSettings.Arrow then
                    espElement.CurrentSettings.Arrow.Enabled = Value
                end
            end
        end
    end
})

ESPSettingsSection:Slider({
    Title = "显示距离",
    Desc = "ESP最大显示距离",
    Step = 100,
    Value = {
        Min = 500,
        Max = 50000, 
        Default = 2000
    },
    Callback = function(Value)
        if ESPElements then
            for _, espElement in pairs(ESPElements) do
                if espElement and not espElement.Deleted and espElement.CurrentSettings then
                    espElement.CurrentSettings.MaxDistance = Value
                end
            end
        end
    end
})

ESPSettingsSection:Slider({
    Title = "填充透明度",
    Desc = "ESP填充透明度",
    Step = 0.1,
    Value = {
        Min = 0,
        Max = 1,
        Default = 0.3
    },
    Callback = function(Value)
        if ESPElements then
            for _, espElement in pairs(ESPElements) do
                if espElement and not espElement.Deleted and espElement.CurrentSettings then
                    espElement.CurrentSettings.FillTransparency = Value
                end
            end
        end
    end
})

local ESPEnabled = false
local ESPElements = {}

local function enableAdvancedESP()
    ESPEnabled = true
    local Players = game:GetService("Players")
    
    local function setupPlayerESP(player)
        if player == Players.LocalPlayer then return end
        
        local randomColor = Color3.new(
            math.random(),
            math.random(), 
            math.random()
        )
        
        local function onCharacterAdded(character)
            if not ESPEnabled then return end
            
            local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 10)
            if not humanoidRootPart then return end
            
            if ESPElements[player] and not ESPElements[player].Deleted then
                ESPElements[player]:Destroy()
            end
            
            local espElement = ESPLibrary:Add({
                Name = player.Name,
                Model = character,
                Color = randomColor,
                MaxDistance = 2000,
                TextSize = 14,
                ESPType = "Highlight",
                FillColor = randomColor,
                OutlineColor = Color3.new(1, 1, 1),
                FillTransparency = 0.3,
                OutlineTransparency = 0,
                Tracer = {
                    Enabled = true,
                    Color = randomColor,
                    Thickness = 1,
                    Transparency = 0,
                    From = "Bottom"
                },
                Arrow = {
                    Enabled = true,
                    Color = randomColor,
                    Size = 15,
                    Transparency = 0
                }
            })
            
            ESPElements[player] = espElement
        end
        
        if player.Character then
            onCharacterAdded(player.Character)
        end
        
        player.CharacterAdded:Connect(onCharacterAdded)
    end
    
    for _, player in pairs(Players:GetPlayers()) do
        setupPlayerESP(player)
    end
    
    Players.PlayerAdded:Connect(setupPlayerESP)
    
    WindUI:Notify({
        Title = "esp已启用",
        Content = "使用ESP库的增强透视功能",
        Duration = 3,
        Icon = "eye"
    })
end

local function disableAdvancedESP()
    ESPEnabled = false
    
    for player, espElement in pairs(ESPElements) do
        if espElement and not espElement.Deleted then
            espElement:Destroy()
        end
    end
    ESPElements = {}
    
    ESPLibrary:Clear()
    
    WindUI:Notify({
        Title = "esp透视已禁用", 
        Content = "所有ESP元素已清除",
        Duration = 3,
        Icon = "eye-off"
    })
end

local VisualSection = thirdTab:Section({Title = "视觉功能", Icon="lucide:eye", Opened = false})

VisualSection:Toggle({
    Title = "esp透视",
    Desc = "执行后刚开始可能卡顿",
    Default = false,
    Callback = function(state)
        if state then
            enableAdvancedESP()
        else
            disableAdvancedESP()
        end
    end
})

VisualSection:Button({
    Title = "基础透视",
    Desc = "使用Highlight的基础透视",
    Icon = "eye",
    Callback = function()
        _G.FriendColor = Color3.fromRGB(0, 0, 255)
        local function ApplyESP(v)
            if v.Character and v.Character:FindFirstChildOfClass('Humanoid') then
                v.Character.Humanoid.NameDisplayDistance = 9e9
                v.Character.Humanoid.NameOcclusion = "NoOcclusion"
                v.Character.Humanoid.HealthDisplayDistance = 9e9
                v.Character.Humanoid.HealthDisplayType = "AlwaysOn"
            end
        end
        
        for i,v in pairs(game.Players:GetPlayers()) do
            ApplyESP(v)
            v.CharacterAdded:Connect(function()
                task.wait(0.33)
                ApplyESP(v)
            end)
        end
        
        game.Players.PlayerAdded:Connect(function(v)
            ApplyESP(v)
            v.CharacterAdded:Connect(function()
                task.wait(0.33)
                ApplyESP(v)
            end)
        end)
        
        local Players = game:GetService("Players"):GetChildren()
        local RunService = game:GetService("RunService")
        local highlight = Instance.new("Highlight")
        highlight.Name = "Highlight"
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        
        for i, v in pairs(Players) do
            if v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                if not v.Character.HumanoidRootPart:FindFirstChild("Highlight") then
                    local highlightClone = highlight:Clone()
                    highlightClone.Adornee = v.Character
                    highlightClone.Parent = v.Character.HumanoidRootPart
                    highlightClone.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                end
            end
        end
        
        game.Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function(character)
                wait(1)
                if character and character:FindFirstChild("HumanoidRootPart") then
                    if not character.HumanoidRootPart:FindFirstChild("Highlight") then
                        local highlightClone = highlight:Clone()
                        highlightClone.Adornee = character
                        highlightClone.Parent = character.HumanoidRootPart
                        highlightClone.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                    end
                end
            end)
        end)
        
        game.Players.PlayerRemoving:Connect(function(playerRemoved)
            if playerRemoved.Character and playerRemoved.Character:FindFirstChild("HumanoidRootPart") then
                local highlight = playerRemoved.Character.HumanoidRootPart:FindFirstChild("Highlight")
                if highlight then
                    highlight:Destroy()
                end
            end
        end)
    end
})

VisualSection:Toggle({
    Title = "夜视",
    Desc = "Toggle",
    Default = false,
    Callback = function(Value)
        if Value then
            game.Lighting.Ambient = Color3.new(1, 1, 1)
        else
            game.Lighting.Ambient = Color3.new(0, 0, 0)
        end
    end
})

local guangyingSection = thirdTab:Section({Title = "光影效果", Opened = false, Icon="lucide:sparkles"})

guangyingSection:Button({
    Title = "光影",
    Desc = "加载光影效果",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MZEEN2424/Graphics/main/Graphics.xml"))()
    end
})

guangyingSection:Button({
    Title = "光影滤镜",
    Desc = "加载光影滤镜效果", 
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MZEEN2424/Graphics/main/Graphics.xml"))()
    end
})

guangyingSection:Button({
    Title = "超高画质",
    Desc = "加载超高画质效果",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/jHBfJYmS"))()
    end
})

guangyingSection:Button({
    Title = "光影V4",
    Desc = "加载光影V4效果",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MZEEN2424/Graphics/main/Graphics.xml"))()
    end
})

guangyingSection:Button({
    Title = "RTX高仿",
    Desc = "加载RTX高仿效果",
    Callback = function()
        loadstring(game:HttpGet('https://pastebin.com/raw/Bkf0BJb3'))()
    end
})

guangyingSection:Button({
    Title = "光影深",
    Desc = "加载深色光影效果",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MZEEN2424/Graphics/main/Graphics.xml"))()
    end
})

guangyingSection:Button({
    Title = "光影浅",
    Desc = "加载浅色光影效果", 
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/jHBfJYmS"))()
    end
})

local AimSection = secondTab:Section({
    Title = "自瞄设置",
    Icon="lucide:crosshair",
    Opened = false
})

local currentAimbotConnection = nil
local currentFOVring = nil
local currentInputConnection = nil
local rainbowHue = 0

local function cleanupCurrentAimbot()
    if currentAimbotConnection then
        currentAimbotConnection:Disconnect()
        currentAimbotConnection = nil
    end
    
    if currentFOVring then
        currentFOVring:Remove()
        currentFOVring = nil
    end
    
    if currentInputConnection then
        currentInputConnection:Disconnect()
        currentInputConnection = nil
    end
end

AimSection:Button({
    Title = "关闭自瞄",
    Desc = "停止所有自瞄功能",
    Callback = function()
        cleanupCurrentAimbot()
        WindUI:Notify({
            Title = "自瞄已关闭",
            Content = "所有自瞄功能已停止",
            Duration = 3,
            Icon = "target"
        })
    end
})

local function createAimbot(fov)
    cleanupCurrentAimbot()
    
    local RunService = game:GetService("RunService")
    local UserInputService = game:GetService("UserInputService")
    local Players = game:GetService("Players")
    local Cam = game.Workspace.CurrentCamera
    
    currentFOVring = Drawing.new("Circle")
    currentFOVring.Visible = true
    currentFOVring.Thickness = 1
    currentFOVring.NumSides = 64
    currentFOVring.Filled = false
    currentFOVring.Radius = fov
    currentFOVring.Position = Cam.ViewportSize / 2
    
    local function updateDrawings()
        local camViewportSize = Cam.ViewportSize
        currentFOVring.Position = camViewportSize / 2
        
        rainbowHue = (rainbowHue + 0.02) % 1
        local color = Color3.fromHSV(rainbowHue, 1, 1)
        currentFOVring.Color = color
    end
    
    local function onKeyDown(input)
        if input.KeyCode == Enum.KeyCode.Delete then
            cleanupCurrentAimbot()
        end
    end
    
    currentInputConnection = UserInputService.InputBegan:Connect(onKeyDown)
    
    local function lookAt(target)
        local lookVector = (target - Cam.CFrame.Position).unit
        local newCFrame = CFrame.new(Cam.CFrame.Position, Cam.CFrame.Position + lookVector)
        Cam.CFrame = newCFrame
    end
    
    local function getClosestPlayerInFOV(trg_part)
        local nearest = nil
        local last = math.huge
        local playerMousePos = Cam.ViewportSize / 2
    
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer then
                local part = player.Character and player.Character:FindFirstChild(trg_part)
                if part then
                    local ePos, isVisible = Cam:WorldToViewportPoint(part.Position)
                    local distance = (Vector2.new(ePos.x, ePos.y) - playerMousePos).Magnitude
    
                    if distance < last and isVisible and distance < fov then
                        last = distance
                        nearest = player
                    end
                end
            end
        end
    
        return nearest
    end
    
    currentAimbotConnection = RunService.RenderStepped:Connect(function()
        updateDrawings()
        local closest = getClosestPlayerInFOV("Head")
        if closest and closest.Character and closest.Character:FindFirstChild("Head") then
            lookAt(closest.Character.Head.Position)
        end
    end)
end

local aimButtons = {
    {title = "自瞄10", fov = 15, desc = "小范围自瞄"},
    {title = "自瞄30", fov = 30, desc = "中等范围自瞄"},
    {title = "自瞄50", fov = 50, desc = "标准范围自瞄"},
    {title = "自瞄100", fov = 100, desc = "大范围自瞄"},
    {title = "自瞄200", fov = 200, desc = "超大范围自瞄"},
    {title = "自瞄300", fov = 300, desc = "广角自瞄"},
    {title = "自瞄400", fov = 400, desc = "超广角自瞄"},
    {title = "自瞄全屏", fov = 1600, desc = "全屏自瞄"}
}

for _, btn in ipairs(aimButtons) do
    AimSection:Button({
        Title = btn.title,
        Desc = btn.desc,
        Callback = function()
            createAimbot(btn.fov)
            WindUI:Notify({
                Title = "自瞄已开启",
                Content = btn.title .. " 已激活",
                Duration = 3,
                Icon = "crosshair"
            })
        end
    })
end

local RangeSection = secondTab:Section({
    Title = "打击范围设置",
    Icon="lucide:boxes",
    Opened = false
})


local _G = _G or getgenv()
_G.HeadSize = 15
_G.Disabled = false

RangeSection:Input({
    Title = "自定义范围",
    Desc = "输入HitBox大小",
    Placeholder = "输入数字",
    Callback = function(Value)
        if Value == nil or Value == "" then
            return
        end
        
        _G.HeadSize = tonumber(Value)
        _G.Disabled = true 
        if _G.HeadSize then
            for i,v in next, game:GetService('Players'):GetPlayers() do
                if v.Name ~= game:GetService('Players').LocalPlayer.Name then 
                    pcall(function()
                        if v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                            v.Character.HumanoidRootPart.Size = Vector3.new(_G.HeadSize,_G.HeadSize,_G.HeadSize) 
                            v.Character.HumanoidRootPart.Transparency = 0.7 
                            v.Character.HumanoidRootPart.BrickColor = BrickColor.new("Really red")
                            v.Character.HumanoidRootPart.Material = "Neon"
                            v.Character.HumanoidRootPart.CanCollide = false
                        end
                    end)
                end 
            end
            WindUI:Notify({
                Title = "范围设置",
                Content = "范围已设置: " .. _G.HeadSize,
                Duration = 3
            })
        else
            WindUI:Notify({
                Title = "错误",
                Content = "请输入有效数字",
                Icon = "alert",
                Duration = 3
            })
        end
    end
})

RangeSection:Button({
    Title = "关闭范围",
    Desc = "恢复默认HitBox",
    Callback = function()
        _G.Disabled = false
        for i,v in next, game:GetService('Players'):GetPlayers() do
            if v.Name ~= game:GetService('Players').LocalPlayer.Name and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                pcall(function()
                    v.Character.HumanoidRootPart.Size = Vector3.new(2, 2, 1)
                    v.Character.HumanoidRootPart.Transparency = 1
                    v.Character.HumanoidRootPart.BrickColor = BrickColor.new("Medium stone grey")
                    v.Character.HumanoidRootPart.Material = "Plastic"
                    v.Character.HumanoidRootPart.CanCollide = true
                end)
            end
        end
        WindUI:Notify({
            Title = "范围关闭",
            Content = "HitBox已恢复默认",
            Duration = 3
        })
    end
})

RangeSection:Button({
    Title = "彩虹范围",
    Desc = "启用彩虹色动态范围",
    Callback = function()
        _G.HeadSize = 20 
        _G.Disabled = true 
        
        local rainbowConnection
        rainbowConnection = game:GetService('RunService').RenderStepped:Connect(function() 
            if _G.Disabled then
                local hue = tick() % 5 / 5
                local r = math.sin(hue * 6.28 + 0) * 127 + 128
                local g = math.sin(hue * 6.28 + 2) * 127 + 128
                local b = math.sin(hue * 6.28 + 4) * 127 + 128
                
                for i,v in next, game:GetService('Players'):GetPlayers() do 
                    if v.Name ~= game:GetService('Players').LocalPlayer.Name and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then 
                        pcall(function() 
                            v.Character.HumanoidRootPart.Size = Vector3.new(_G.HeadSize,_G.HeadSize,_G.HeadSize) 
                            v.Character.HumanoidRootPart.Transparency = 0.7 
                            v.Character.HumanoidRootPart.Color = Color3.fromRGB(r, g, b)
                            v.Character.HumanoidRootPart.Material = "Neon"
                            v.Character.HumanoidRootPart.CanCollide = false
                        end) 
                    end 
                end 
            else
                if rainbowConnection then
                    rainbowConnection:Disconnect()
                end
            end
        end)
        
        WindUI:Notify({
            Title = "彩虹范围",
            Content = "彩虹动态范围已启用",
            Duration = 3
        })
    end
})

local QuickSection = secondTab:Section({Title = "快速调整", Icon = "user", Opened = false})

local quickRanges = {
    {"普通范围", 15, "Really blue"},
    {"中等范围", 50, "Really blue"}, 
    {"超大范围", 100, "Really blue"},
    {"终极范围", 200, "Really blue"},
    {"全图范围", 400, "Really blue"}
}

for _, rangeConfig in ipairs(quickRanges) do
    QuickSection:Button({
        Title = rangeConfig[1],
        Callback = function()
            _G.HeadSize = rangeConfig[2]
            _G.Disabled = true
            if _G.Disabled then
                for i,v in next, game:GetService('Players'):GetPlayers() do
                    if v.Name ~= game:GetService('Players').LocalPlayer.Name and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                        pcall(function()
                            v.Character.HumanoidRootPart.Size = Vector3.new(_G.HeadSize, _G.HeadSize, _G.HeadSize)
                            v.Character.HumanoidRootPart.Transparency = 0.7
                            v.Character.HumanoidRootPart.BrickColor = BrickColor.new(rangeConfig[3])
                            v.Character.HumanoidRootPart.Material = "Neon"
                            v.Character.HumanoidRootPart.CanCollide = false
                        end)
                    end
                end
                WindUI:Notify({
                    Title = "范围设置",
                    Content = rangeConfig[1] .. "已启用: " .. _G.HeadSize,
                    Duration = 3
                })
            end
        end
    })
end

local CustomSection = secondTab:Section({Title = "自定义范围", Icon = "box", Opened = false})

local customRanges = {
    {"范围15", 15}, {"范围50", 50}, {"范围100", 100}, {"范围150", 150},
    {"范围200", 200}, {"范围250", 250}, {"范围300", 300}, {"范围400", 400},
    {"范围500", 500}
}

for _, rangeConfig in ipairs(customRanges) do
    CustomSection:Button({
        Title = rangeConfig[1],
        Callback = function()
            _G.HeadSize = rangeConfig[2]
            _G.Disabled = true
            if _G.Disabled then
                for i,v in next, game:GetService('Players'):GetPlayers() do
                    if v.Name ~= game:GetService('Players').LocalPlayer.Name and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                        pcall(function()
                            v.Character.HumanoidRootPart.Size = Vector3.new(_G.HeadSize, _G.HeadSize, _G.HeadSize)
                            v.Character.HumanoidRootPart.Transparency = 0.7
                            v.Character.HumanoidRootPart.BrickColor = BrickColor.new("Really blue")
                            v.Character.HumanoidRootPart.Material = "Neon"
                            v.Character.HumanoidRootPart.CanCollide = false
                        end)
                    end
                end
                WindUI:Notify({
                    Title = "自定义范围",
                    Content = rangeConfig[1] .. "已设置",
                    Duration = 3
                })
            end
        end
    })
end

local PlayerSection = TeleportTab:Section({Title = "玩家选择", Icon="lucide:list-chevrons-up-down",Opened = false})

local selectedPlayer = nil
local playerList = {}

local function refreshPlayers()
    playerList = {}
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer then
            table.insert(playerList, player.DisplayName)
        end
    end
end

refreshPlayers()

local PlayerDropdown = PlayerSection:Dropdown({
    Title = "选择玩家",
    Values = playerList,
    Value = "",
    Callback = function(selectedDisplayName)
        for _, player in pairs(game.Players:GetPlayers()) do
            if player.DisplayName == selectedDisplayName then
                selectedPlayer = player
                break
            end
        end
    end
})

PlayerSection:Button({
    Title = "刷新玩家列表",
    Callback = function()
        refreshPlayers()
        PlayerDropdown:Refresh(playerList)
    end
})

PlayerSection:Button({
    Title = "查看玩家",
    Callback = function()
        if selectedPlayer and selectedPlayer.Character then
            game.Workspace.CurrentCamera.CameraSubject = selectedPlayer.Character:FindFirstChild("Humanoid")
        end
    end
})

PlayerSection:Button({
    Title = "停止查看",
    Callback = function()
        local localPlayer = game.Players.LocalPlayer
        if localPlayer.Character then
            game.Workspace.CurrentCamera.CameraSubject = localPlayer.Character:FindFirstChild("Humanoid")
        end
    end
})

PlayerSection:Button({
    Title = "甩飞一次选中的人",
    Callback = function()
        local Player = game:GetService("Players").LocalPlayer
        local TargetPlayer = selectedPlayer
        if not TargetPlayer or TargetPlayer == Player then
            WindUI:Notify({Title = "挽", Content = "无玩家可甩飞", Duration = 2})
            return
        end

        local Message = function(_Title, _Text, Time)
            WindUI:Notify({Title = _Title, Content = _Text, Duration = Time})
        end

        local SkidFling = function(Target)
            local Character = Player.Character
            local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
            local RootPart = Humanoid and Humanoid.RootPart
            local TCharacter = Target.Character
            local THumanoid = TCharacter and TCharacter:FindFirstChildOfClass("Humanoid")
            local TRootPart = THumanoid and THumanoid.RootPart
            local THead = TCharacter and TCharacter:FindFirstChild("Head")
            local Accessory = TCharacter and TCharacter:FindFirstChildOfClass("Accessory")
            local Handle = Accessory and Accessory:FindFirstChild("Handle")

            if not (Character and Humanoid and RootPart and TCharacter and THumanoid) then
                return Message("挽", "玩家已趋势", 2)
            end
            if THumanoid.Sit then return Message("挽", "目标处于坐姿", 2) end
            if not TCharacter:FindFirstChildWhichIsA("BasePart") then return Message("挽", "目标无有效部件", 2) end

            if THead then
                workspace.CurrentCamera.CameraSubject = THead
            elseif Handle then
                workspace.CurrentCamera.CameraSubject = Handle
            else
                workspace.CurrentCamera.CameraSubject = THumanoid
            end

            if RootPart.Velocity.Magnitude < 50 then
                getgenv().OldPos = RootPart.CFrame
            end

            local FPos = function(BasePart, Pos, Ang)
                RootPart.CFrame = CFrame.new(BasePart.Position) * Pos * Ang
                Character:SetPrimaryPartCFrame(CFrame.new(BasePart.Position) * Pos * Ang)
                RootPart.Velocity = Vector3.new(9e7, 9e7 * 10, 9e7)
                RootPart.RotVelocity = Vector3.new(9e8, 9e8, 9e8)
            end

            local SFBasePart = function(BasePart)
                local TimeToWait = 6
                local Time = tick()
                local Angle = 0
                repeat
                    if RootPart and THumanoid then
                        if BasePart.Velocity.Magnitude < 50 then
                            Angle = Angle + 100
                            FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                        else
                            FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(90), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(0, 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(90), 0, 0))
                            task.wait()
                        end
                    else
                        break
                    end
                until BasePart.Velocity.Magnitude > 500 or BasePart.Parent ~= Target.Character or Target.Parent ~= game:GetService("Players") or THumanoid.Sit or Humanoid.Health <= 0 or tick() > Time + TimeToWait
            end

            workspace.FallenPartsDestroyHeight = 0/0
            local BV = Instance.new("BodyVelocity")
            BV.Name = "EpixVel"
            BV.Parent = RootPart
            BV.Velocity = Vector3.new(9e8, 9e8, 9e8)
            BV.MaxForce = Vector3.new(1/0, 1/0, 1/0)
            Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)

            if TRootPart and THead then
                SFBasePart((TRootPart.CFrame.p - THead.CFrame.p).Magnitude > 5 and THead or TRootPart)
            elseif TRootPart then
                SFBasePart(TRootPart)
            elseif THead then
                SFBasePart(THead)
            elseif Handle then
                SFBasePart(Handle)
            else
                return Message("挽", "玩家已趋势", 2)
            end

            BV:Destroy()
            Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, true)
            workspace.CurrentCamera.CameraSubject = Humanoid
            getgenv().FPDH = getgenv().FPDH or workspace.FallenPartsDestroyHeight

            repeat
                RootPart.CFrame = getgenv().OldPos * CFrame.new(0, 0.5, 0)
                Character:SetPrimaryPartCFrame(getgenv().OldPos * CFrame.new(0, 0.5, 0))
                Humanoid:ChangeState("GettingUp")
                table.foreach(Character:GetChildren(), function(_, x)
                    if x:IsA("BasePart") then x.Velocity, x.RotVelocity = Vector3.new(), Vector3.new() end
                end)
                task.wait()
            until (RootPart.Position - getgenv().OldPos.p).Magnitude < 25
            workspace.FallenPartsDestroyHeight = getgenv().FPDH
            Message("挽", "已甩飞选中玩家", 2)
        end

        if TargetPlayer.UserId ~= 1414978355 then
            SkidFling(TargetPlayer)
        else
            Message("挽", "该玩家存在甩飞名单", 2)
        end
    end
})

PlayerSection:Toggle({
    Title = "锁定甩飞选中的人",
    Desc = "LoopFling",
    Value = false,
    Callback = function(state)
        getgenv().LoopFlingEnabled = state
        local connection
        if state and selectedPlayer then
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                if not getgenv().LoopFlingEnabled or not selectedPlayer or selectedPlayer == game.Players.LocalPlayer then
                    if connection then connection:Disconnect() end
                    return
                end

                local Player = game.Players.LocalPlayer
                local Target = selectedPlayer
                local Character = Player.Character
                local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
                local RootPart = Humanoid and Humanoid.RootPart
                local TCharacter = Target.Character
                local THumanoid = TCharacter and TCharacter:FindFirstChildOfClass("Humanoid")
                local TRootPart = THumanoid and THumanoid.RootPart
                local THead = TCharacter and TCharacter:FindFirstChild("Head")
                local Accessory = TCharacter and TCharacter:FindFirstChildOfClass("Accessory")
                local Handle = Accessory and Accessory:FindFirstChild("Handle")

                if not (Character and Humanoid and RootPart and TCharacter and THumanoid) then
                    WindUI:Notify({Title = "挽", Content = "无玩家可甩飞", Duration = 2})
                    return
                end
                if THumanoid.Sit then
                    WindUI:Notify({Title = "挽", Content = "目标处于坐姿", Duration = 2})
                    return
                end
                if not TCharacter:FindFirstChildWhichIsA("BasePart") then
                    WindUI:Notify({Title = "挽", Content = "玩家已趋势", Duration = 2})
                    return
                end

                if THead then
                    workspace.CurrentCamera.CameraSubject = THead
                elseif Handle then
                    workspace.CurrentCamera.CameraSubject = Handle
                else
                    workspace.CurrentCamera.CameraSubject = THumanoid
                end

                if RootPart.Velocity.Magnitude < 50 then
                    getgenv().OldPos = RootPart.CFrame
                end

                local FPos = function(BasePart, Pos, Ang)
                    RootPart.CFrame = CFrame.new(BasePart.Position) * Pos * Ang
                    Character:SetPrimaryPartCFrame(CFrame.new(BasePart.Position) * Pos * Ang)
                    RootPart.Velocity = Vector3.new(9e7, 9e7 * 10, 9e7)
                    RootPart.RotVelocity = Vector3.new(9e8, 9e8, 9e8)
                end

                local SFBasePart = function(BasePart)
                    local TimeToWait = 6
                    local Time = tick()
                    local Angle = 0
                    repeat
                        if RootPart and THumanoid then
                            if BasePart.Velocity.Magnitude < 50 then
                                Angle = Angle + 100
                                FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                                task.wait()
                                FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                                task.wait()
                                FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                                task.wait()
                                FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(Angle), 0, 0))
                                task.wait()
                            else
                                FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(90), 0, 0))
                                task.wait()
                                FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(0, 0, 0))
                                task.wait()
                                FPos(BasePart, CFrame.new(0, 0, 0), CFrame.Angles(math.rad(90), 0, 0))
                                task.wait()
                            end
                        else
                            break
                        end
                    until BasePart.Velocity.Magnitude > 500 or BasePart.Parent ~= Target.Character or Target.Parent ~= game.Players or THumanoid.Sit or Humanoid.Health <= 0 or tick() > Time + TimeToWait
                end

                workspace.FallenPartsDestroyHeight = 0/0
                local BV = Instance.new("BodyVelocity")
                BV.Name = "EpixVel"
                BV.Parent = RootPart
                BV.Velocity = Vector3.new(9e8, 9e8, 9e8)
                BV.MaxForce = Vector3.new(1/0, 1/0, 1/0)
                Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)

                if TRootPart and THead then
                    SFBasePart((TRootPart.CFrame.p - THead.CFrame.p).Magnitude > 5 and THead or TRootPart)
                elseif TRootPart then
                    SFBasePart(TRootPart)
                elseif THead then
                    SFBasePart(THead)
                elseif Handle then
                    SFBasePart(Handle)
                end

                BV:Destroy()
                Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, true)
                workspace.CurrentCamera.CameraSubject = Humanoid
                getgenv().FPDH = getgenv().FPDH or workspace.FallenPartsDestroyHeight

                repeat
                    RootPart.CFrame = getgenv().OldPos * CFrame.new(0, 0.5, 0)
                    Character:SetPrimaryPartCFrame(getgenv().OldPos * CFrame.new(0, 0.5, 0))
                    Humanoid:ChangeState("GettingUp")
                    table.foreach(Character:GetChildren(), function(_, x)
                        if x:IsA("BasePart") then x.Velocity, x.RotVelocity = Vector3.new(), Vector3.new() end
                    end)
                    task.wait()
                until (RootPart.Position - getgenv().OldPos.p).Magnitude < 25
                workspace.FallenPartsDestroyHeight = getgenv().FPDH
            end)
        else
            if connection then connection:Disconnect() end
        end
    end
})

local flingEnabled = false
local flingThread = nil

PlayerSection:Toggle({
    Title = "触碰甩飞",
    Desc = "可能无效",
    Value = false,
    Callback = function(state)
        flingEnabled = state
        if flingEnabled then
            if flingThread then return end
            flingThread = task.spawn(function()
                local Players = game:GetService("Players")
                local RunService = game:GetService("RunService")
                local flingPower = 2500
                local movel = 0.05
                local lp = Players.LocalPlayer
                local character = lp.Character or lp.CharacterAdded:Wait()
                local hrp = character:WaitForChild("HumanoidRootPart")
                while flingEnabled do
                    RunService.Heartbeat:Wait()
                    local originalVelocity = hrp.Velocity
                    hrp.Velocity = originalVelocity * 1.5 + Vector3.new(0, flingPower, 0)
                    RunService.RenderStepped:Wait()
                    hrp.Velocity = originalVelocity * 0.8
                    RunService.Stepped:Wait()
                    hrp.Velocity = originalVelocity + Vector3.new(0, movel, 0)
                    movel = -movel
                end
                flingThread = nil
            end)
        else
            flingEnabled = false
            flingThread = nil
        end
    end
})

local DisasterSection = TeleportTab:Section({Title = "传送功能", Icon="lucide:chevrons-left-right-ellipsis",Opened = false})

DisasterSection:Button({
    Title = "传送到玩家旁边",
    Callback = function()
        if selectedPlayer and selectedPlayer.Character then
            local targetPos = selectedPlayer.Character:FindFirstChild("HumanoidRootPart").Position
            game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(targetPos + Vector3.new(3, 0, 3))
        end
    end
})

local LockTPToggle = DisasterSection:Toggle({
    Title = "锁定传送",
    Default = false,
    Callback = function(state)
        if state and selectedPlayer then
            local connection
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                if not selectedPlayer or not selectedPlayer.Character then
                    connection:Disconnect()
                    return
                end
                local targetPos = selectedPlayer.Character:FindFirstChild("HumanoidRootPart").Position
                game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(targetPos + Vector3.new(3, 0, 3))
            end)
        end
    end
})

DisasterSection:Button({
    Title = "把玩家传送过来",
    Callback = function()
        if selectedPlayer and selectedPlayer.Character then
            local myChar = game.Players.LocalPlayer.Character
            if myChar then
                local myPos = myChar:FindFirstChild("HumanoidRootPart").Position
                selectedPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(myPos + Vector3.new(3, 0, 3))
            end
        end
    end
})

local LoopTPToggle = DisasterSection:Toggle({
    Title = "循环把玩家传送过来",
    Default = false,
    Callback = function(state)
        if state and selectedPlayer then
            local connection
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                if not selectedPlayer or not selectedPlayer.Character then
                    connection:Disconnect()
                    return
                end
                local myChar = game.Players.LocalPlayer.Character
                if myChar then
                    local myPos = myChar:FindFirstChild("HumanoidRootPart").Position
                    selectedPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(myPos + Vector3.new(3, 0, 3))
                end
            end)
        end
    end
})

local AttractSection = TeleportTab:Section({Title = "吸附功能", Icon="lucide:rose",Opened = false})

local AttractToggle = AttractSection:Toggle({
    Title = "吸附所有人",
    Default = false,
    Callback = function(state)
        if state then
            local connection
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                local myChar = game.Players.LocalPlayer.Character
                if myChar then
                    local myPos = myChar:FindFirstChild("HumanoidRootPart").Position
                    for _, player in pairs(game.Players:GetPlayers()) do
                        if player ~= game.Players.LocalPlayer and player.Character then
                            player.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(myPos + Vector3.new(3, 0, 3))
                        end
                    end
                end
            end)
        end
    end
})

local ThrowSection = TeleportTab:Section({Title = "甩飞", Icon="lucide:brush-cleaning",Opened = false})

ThrowSection:Button({
    Title = "甩飞所有人",
    Callback = function()
    local Targets = {"All"}
    local Players = game:GetService("Players")
    local Player = Players.LocalPlayer
    local AllBool = false
    local GetPlayer = function(Name)
        Name = Name:lower()
        if Name == "all" or Name == "others" then
            AllBool = true
            return
        elseif Name == "random" then
            local GetPlayers = Players:GetPlayers()
            if table.find(GetPlayers,Player) then table.remove(GetPlayers,table.find(GetPlayers,Player)) end
            return GetPlayers[math.random(#GetPlayers)]
        elseif Name ~= "random" and Name ~= "all" and Name ~= "others" then
            for _,x in next, Players:GetPlayers() do
                if x ~= Player then
                    if x.Name:lower():match("^"..Name) then
                        return x;
                    elseif x.DisplayName:lower():match("^"..Name) then
                        return x;
                    end
                end
            end
        else
            return
        end
    end
    local Message = function(_Title, _Text, Time)
        game:GetService("StarterGui"):SetCore("SendNotification", {Title = _Title, Text = _Text, Duration = Time, Icon = "rbxassetid://105677776902677"})
    end
    local SkidFling = function(TargetPlayer)
        local Character = Player.Character
        local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
        local RootPart = Humanoid and Humanoid.RootPart
        local TCharacter = TargetPlayer.Character
        local THumanoid
        local TRootPart
        local THead
        local Accessory
        local Handle
        if TCharacter:FindFirstChildOfClass("Humanoid") then
            THumanoid = TCharacter:FindFirstChildOfClass("Humanoid")
        end
        if THumanoid and THumanoid.RootPart then
            TRootPart = THumanoid.RootPart
        end
        if TCharacter:FindFirstChild("Head") then
            THead = TCharacter.Head
        end
        if TCharacter:FindFirstChildOfClass("Accessory") then
            Accessory = TCharacter:FindFirstChildOfClass("Accessory")
        end
        if Accessoy and Accessory:FindFirstChild("Handle") then
            Handle = Accessory.Handle
        end
        if Character and Humanoid and RootPart then
            if RootPart.Velocity.Magnitude < 50 then
                getgenv().OldPos = RootPart.CFrame
            end
            if THumanoid and THumanoid.Sit and not AllBool then
                return Message("错误提示", "目标处于坐姿", 2)
            end
            if THead then
                workspace.CurrentCamera.CameraSubject = THead
            elseif not THead and Handle then
                workspace.CurrentCamera.CameraSubject = Handle
            elseif THumanoid and TRootPart then
                workspace.CurrentCamera.CameraSubject = THumanoid
            end
            if not TCharacter:FindFirstChildWhichIsA("BasePart") then
                return
            end
            
            local FPos = function(BasePart, Pos, Ang)
                RootPart.CFrame = CFrame.new(BasePart.Position) * Pos * Ang
                Character:SetPrimaryPartCFrame(CFrame.new(BasePart.Position) * Pos * Ang)
                RootPart.Velocity = Vector3.new(9e7, 9e7 * 10, 9e7)
                RootPart.RotVelocity = Vector3.new(9e8, 9e8, 9e8)
            end
            
            local SFBasePart = function(BasePart)
                local TimeToWait = 2
                local Time = tick()
                local Angle = 0
                repeat
                    if RootPart and THumanoid then
                        if BasePart.Velocity.Magnitude < 50 then
                            Angle = Angle + 100
                            FPos(BasePart, CFrame.new(0, 1.5, 0) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle),0 ,0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5, 0) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(2.25, 1.5, -2.25) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(-2.25, -1.5, 2.25) + THumanoid.MoveDirection * BasePart.Velocity.Magnitude / 1.25, CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 1.5, 0) + THumanoid.MoveDirection,CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5, 0) + THumanoid.MoveDirection,CFrame.Angles(math.rad(Angle), 0, 0))
                            task.wait()
                        else
                            FPos(BasePart, CFrame.new(0, 1.5, THumanoid.WalkSpeed), CFrame.Angles(math.rad(90), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5, -THumanoid.WalkSpeed), CFrame.Angles(0, 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 1.5, THumanoid.WalkSpeed), CFrame.Angles(math.rad(90), 0, 0))
                            task.wait()
                            
                            FPos(BasePart, CFrame.new(0, 1.5, TRootPart.Velocity.Magnitude / 1.25), CFrame.Angles(math.rad(90), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5, -TRootPart.Velocity.Magnitude / 1.25), CFrame.Angles(0, 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, 1.5, TRootPart.Velocity.Magnitude / 1.25), CFrame.Angles(math.rad(90), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5, 0), CFrame.Angles(math.rad(90), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5, 0), CFrame.Angles(0, 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5 ,0), CFrame.Angles(math.rad(-90), 0, 0))
                            task.wait()
                            FPos(BasePart, CFrame.new(0, -1.5, 0), CFrame.Angles(0, 0, 0))
                            task.wait()
                        end
                    else
                        break
                    end
                until BasePart.Velocity.Magnitude > 500 or BasePart.Parent ~= TargetPlayer.Character or TargetPlayer.Parent ~= Players or not TargetPlayer.Character == TCharacter or THumanoid.Sit or Humanoid.Health <= 0 or tick() > Time + TimeToWait
            end
            
            workspace.FallenPartsDestroyHeight = 0/0
            
            local BV = Instance.new("BodyVelocity")
            BV.Name = "EpixVel"
            BV.Parent = RootPart
            BV.Velocity = Vector3.new(9e8, 9e8, 9e8)
            BV.MaxForce = Vector3.new(1/0, 1/0, 1/0)
            
            Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)
            
            if TRootPart and THead then
                if (TRootPart.CFrame.p - THead.CFrame.p).Magnitude > 5 then
                    SFBasePart(THead)
                else
                    SFBasePart(TRootPart)
                end
            elseif TRootPart and not THead then
                SFBasePart(TRootPart)
            elseif not TRootPart and THead then
                SFBasePart(THead)
            elseif not TRootPart and not THead and Accessory and Handle then
                SFBasePart(Handle)
            else
                return Message("null", "玩家已趋势", 2)
            end
            
            BV:Destroy()
            Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, true)
            workspace.CurrentCamera.CameraSubject = Humanoid
            
            repeat
                RootPart.CFrame = getgenv().OldPos * CFrame.new(0, .5, 0)
                Character:SetPrimaryPartCFrame(getgenv().OldPos * CFrame.new(0, .5, 0))
                Humanoid:ChangeState("GettingUp")
                table.foreach(Character:GetChildren(), function(_, x)
                    if x:IsA("BasePart") then
                        x.Velocity, x.RotVelocity = Vector3.new(), Vector3.new()
                    end
                end)
                task.wait()
            until (RootPart.Position - getgenv().OldPos.p).Magnitude < 25
            workspace.FallenPartsDestroyHeight = getgenv().FPDH
        else
            return Message("挽", "随机错误", 2)
        end
    end
    local hasPlayers = false
    for _,x in next, Players:GetPlayers() do
        if x ~= Player then
            hasPlayers = true
            break
        end
    end
    if not hasPlayers then
        return Message("挽", "无玩家可以甩飞", 2)
    end
    if not Welcome then Message("挽", "甩飞增强版", 2) end
    getgenv().Welcome = true
    if Targets[1] then for _,x in next, Targets do GetPlayer(x) end else return end
    if AllBool then
        for _,x in next, Players:GetPlayers() do
            SkidFling(x)
        end
    end
    for _,x in next, Targets do
        if GetPlayer(x) and GetPlayer(x) ~= Player then
            if GetPlayer(x).UserId ~= 1414978355 then
                local TPlayer = GetPlayer(x)
                if TPlayer then
                    SkidFling(TPlayer)
                end
            else
                Message("挽", "该玩家已经存在甩飞名单", 2)
            end
        elseif not GetPlayer(x) and not AllBool then
            Message("挽", "玩家掉线", 2)
        end
    end
end
})

local PositionSection = TeleportTab:Section({Title = "传送玩家前后方", Icon="lucide:arrow-down-up",Opened = false})

local FrontDistance = 5
local FrontSlider = PositionSection:Slider({
    Title = "传送至玩家前方距离",
    Step = 1,
    Value = {
        Min = 1,
        Max = 50,
        Default = 5,
    },
    Callback = function(value)
        FrontDistance = value
    end
})

local FrontToggle = PositionSection:Toggle({
    Title = "循环传送至玩家前方",
    Default = false,
    Callback = function(state)
        if state and selectedPlayer then
            local connection
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                if not selectedPlayer or not selectedPlayer.Character then
                    connection:Disconnect()
                    return
                end
                local targetCF = selectedPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
                local frontPos = targetCF.Position + targetCF.LookVector * FrontDistance
                if game.Players.LocalPlayer.Character then
                    game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(frontPos)
                end
            end)
        end
    end
})

local HeadDistance = 5
local HeadSlider = PositionSection:Slider({
    Title = "传送至玩家头顶距离",
    Step = 1,
    Value = {
        Min = 1,
        Max = 50,
        Default = 5,
    },
    Callback = function(value)
        HeadDistance = value
    end
})

local HeadToggle = PositionSection:Toggle({
    Title = "循环传送至玩家头顶",
    Default = false,
    Callback = function(state)
        if state and selectedPlayer then
            local connection
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                if not selectedPlayer or not selectedPlayer.Character then
                    connection:Disconnect()
                    return
                end
                local targetPos = selectedPlayer.Character:FindFirstChild("HumanoidRootPart").Position
                if game.Players.LocalPlayer.Character then
                    game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(targetPos.X, targetPos.Y + HeadDistance, targetPos.Z)
                end
            end)
        end
    end
})

local BackDistance = 5
local BackSlider = PositionSection:Slider({
    Title = "传送至玩家后面距离",
    Step = 1,
    Value = {
        Min = 1,
        Max = 50,
        Default = 5,
    },
    Callback = function(value)
        BackDistance = value
    end
})

local BackToggle = PositionSection:Toggle({
    Title = "循环传送至玩家后面",
    Default = false,
    Callback = function(state)
        if state and selectedPlayer then
            local connection
            connection = game:GetService("RunService").Heartbeat:Connect(function()
                if not selectedPlayer or not selectedPlayer.Character then
                    connection:Disconnect()
                    return
                end
                local targetCF = selectedPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
                local backPos = targetCF.Position - targetCF.LookVector * BackDistance
                if game.Players.LocalPlayer.Character then
                    game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = CFrame.new(backPos)
                end
            end)
        end
    end
})

local SpinSection = SpinTab:Section({
    Title = "旋转速度",
    Opened = true
})

SpinSection:Button({
    Title = "关闭旋转",
    Desc = "停止所有旋转效果",
    Callback = function()
        local plr = game:GetService("Players").LocalPlayer
        if plr.Character then
            local humRoot = plr.Character:FindFirstChild("HumanoidRootPart")
            if humRoot then
                local spinbot = humRoot:FindFirstChild("Spinbot")
                if spinbot then
                    spinbot:Destroy()
                end
            end
            
            local humanoid = plr.Character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.AutoRotate = true
            end
        end
        WindUI:Notify({
            Title = "旋转已关闭",
            Content = "所有旋转效果已停止",
            Duration = 3,
            Icon = "square"
        })
    end
})

local spinSpeeds = {
    {title = "旋转10", speed = 10, desc = "慢速旋转"},
    {title = "旋转30", speed = 30, desc = "中速旋转"},
    {title = "旋转40", speed = 40, desc = "中快速旋转"},
    {title = "旋转50", speed = 50, desc = "快速旋转"},
    {title = "旋转60", speed = 60, desc = "较快旋转"},
    {title = "旋转70", speed = 70, desc = "高速旋转"},
    {title = "旋转80", speed = 80, desc = "超高速旋转"},
    {title = "旋转90", speed = 90, desc = "极速旋转"},
    {title = "旋转100", speed = 100, desc = "超极速旋转"},
    {title = "旋转150", speed = 150, desc = "疯狂旋转"},
    {title = "旋转200", speed = 200, desc = "超疯狂旋转"},
    {title = "旋转250", speed = 250, desc = "极限旋转"},
    {title = "旋转300", speed = 300, desc = "超极限旋转"},
    {title = "旋转350", speed = 350, desc = "光速旋转"},
    {title = "旋转400", speed = 400, desc = "终极旋转"}
}

for _, spin in ipairs(spinSpeeds) do
    SpinSection:Button({
        Title = spin.title,
        Desc = spin.desc,
        Callback = function()
            local speed = spin.speed
            local plr = game:GetService("Players").LocalPlayer
            repeat task.wait() until plr.Character
            local humRoot = plr.Character:WaitForChild("HumanoidRootPart")
            plr.Character:WaitForChild("Humanoid").AutoRotate = false
            local velocity = Instance.new("AngularVelocity")
            velocity.Attachment0 = humRoot:WaitForChild("RootAttachment")
            velocity.MaxTorque = math.huge
            velocity.AngularVelocity = Vector3.new(0, speed, 0)
            velocity.Parent = humRoot
            velocity.Name = "Spinbot"
            
            WindUI:Notify({
                Title = "旋转已开启",
                Content = spin.title .. " 已激活",
                Duration = 3,
                Icon = "rotate-cw"
            })
        end
    })
end

local JisuSection = serve1:Section({
    Title = "极速传奇功能",
    Icon="tornado",
    Opened = false
})

JisuSection:Button({
    Title = "关于",
    Desc = "进入对应的服务器会加载相关脚本",
    Callback = function()
loadstring(game:HttpGet('https://raw.githubusercontent.com/XxwanhexxX/321/refs/heads/main/%E5%8A%9B%E9%87%8F%E4%BC%A0%E5%A5%87'))()
    end
})

local LiLiangSection = serve1:Section({
    Title = "力量传奇",
    Icon="tornado",
    Opened = false
})

LiLiangSection:Button({
    Title = "关于",
    Desc = "进入对应的服务器会加载相关脚本",
    Callback = function()
loadstring(game:HttpGet('https://raw.githubusercontent.com/XxwanhexxX/321/refs/heads/main/%E5%8A%9B%E9%87%8F%E4%BC%A0%E5%A5%87'))()
    end
})

local DisasterSection = serve1:Section({
    Title = "自然灾害功能",
    Icon = "tornado",
    Opened = false 
})

DisasterSection:Toggle({
    Title = "自动胜利v1",
    Desc = "传送到胜利位置1",
    Value = false,
    Callback = function(bool)
        _G.autowinfarm1 = bool
        while wait(.1) and _G.autowinfarm1 do
            if _G.autowinfarm1 then
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChild("HumanoidRootPart") then
                    character.HumanoidRootPart.CFrame = CFrame.new(-236, 180, 360, 1, 0, 0, 0, 1, 0, 0, 0, 1)
                end
            end
        end
    end
})

DisasterSection:Toggle({
    Title = "自动胜利v2",
    Desc = "传送到胜利位置2",
    Value = false,
    Callback = function(bool)
        _G.autowinfarm2 = bool
        while wait(.1) and _G.autowinfarm2 do
            if _G.autowinfarm2 then
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChild("HumanoidRootPart") then
                    character.HumanoidRootPart.CFrame = CFrame.new(-280, 170, 341, 1, 0, 0, 0, 1, 0, 0, 0, 1)
                end
            end
        end
    end
})

DisasterSection:Divider()

local nextdis
DisasterSection:Toggle({
    Title = "预测本次灾害(在灾害局内)",
    Desc = "在灾害局内预测当前灾害",
    Value = false,
    Callback = function(val)
        nextdis = val
        while wait(1) and nextdis do
            local SurvivalTag = game.Players.LocalPlayer.Character:FindFirstChild("SurvivalTag")
            if SurvivalTag then
                local disasterTexts = {
                    ["Blizzard"] = "下一个灾难是：暴风雪",
                    ["Sandstorm"] = "下一个灾难是：沙尘暴",
                    ["Tornado"] = "下一个灾难是：龙卷风",
                    ["Volcanic Eruption"] = "下一个灾难是：火山",
                    ["Flash Flood"] = "下一个灾难是：洪水",
                    ["Deadly Virus"] = "下一个灾难是：病毒",
                    ["Tsunami"] = "下一个灾难是：海啸",
                    ["Acid Rain"] = "下一个灾难是：酸雨",
                    ["Fire"] = "下一个灾难是：火焰",
                    ["Meteor Shower"] = "下一个灾难是：流星雨",
                    ["Earthquake"] = "下一个灾难是：地震",
                    ["Thunder Storm"] = "下一个灾难是：雷击"
                }
                
                if disasterTexts[SurvivalTag.Value] then
                    WindUI:Notify({
                        Title = "灾害预测",
                        Content = disasterTexts[SurvivalTag.Value],
                        Duration = 5,
                        Icon = "alert-circle"
                    })
                end
            end
        end
    end
})

DisasterSection:Toggle({
    Title = "预测下个灾害(在灾害局外)",
    Desc = "在灾害局外预测下一个灾害",
    Value = false,
    Callback = function(val)
        nextdis = val
        while wait(1) and nextdis do
            local SurvivalTag = game.Players.LocalPlayer.Character:FindFirstChild("SurvivalTag")
            if SurvivalTag then
                local disasterTexts = {
                    ["Blizzard"] = "下一个灾难是：暴风雪",
                    ["Sandstorm"] = "下一个灾难是：沙尘暴",
                    ["Tornado"] = "下一个灾难是：龙卷风",
                    ["Volcanic Eruption"] = "下一个灾难是：火山",
                    ["Flash Flood"] = "下一个灾难是：洪水",
                    ["Deadly Virus"] = "下一个灾难是：病毒",
                    ["Tsunami"] = "下一个灾难是：海啸",
                    ["Acid Rain"] = "下一个灾难是：酸雨",
                    ["Fire"] = "下一个灾难是：火焰",
                    ["Meteor Shower"] = "下一个灾难是：流星雨",
                    ["Earthquake"] = "下一个灾难是：地震",
                    ["Thunder Storm"] = "下一个灾难是：暴风雨"
                }
                
                if disasterTexts[SurvivalTag.Value] then
                    WindUI:Notify({
                        Title = "灾害预测",
                        Content = disasterTexts[SurvivalTag.Value],
                        Duration = 5,
                        Icon = "alert-circle"
                    })
                end
            end
        end
    end
})

DisasterSection:Button({
    Title = "打印下一次灾害信息",
    Desc = "显示下一次灾害信息",
    Callback = function()
        local SurvivalTag = game.Players.LocalPlayer.Character:FindFirstChild("SurvivalTag")
        if SurvivalTag then
            local disasterTexts = {
                ["Blizzard"] = "下一个灾难是：暴风雪",
                ["Sandstorm"] = "下一个灾难是：沙尘暴",
                ["Tornado"] = "下一个灾难是：龙卷风",
                ["Volcanic Eruption"] = "下一个灾难是：火山",
                ["Flash Flood"] = "下一个灾难是：洪水",
                ["Deadly Virus"] = "下一个灾难是：病毒",
                ["Tsunami"] = "下一个灾难是：海啸",
                ["Acid Rain"] = "下一个灾难是：酸雨",
                ["Fire"] = "下一个灾难是：火焰",
                ["Meteor Shower"] = "下一个灾难是：流星雨",
                ["Earthquake"] = "下一个灾难是：地震",
                ["Thunder Storm"] = "下一个灾难是：雷击"
            }
            
            if disasterTexts[SurvivalTag.Value] then
                WindUI:Notify({
                    Title = "灾害预测",
                    Content = disasterTexts[SurvivalTag.Value],
                    Duration = 5,
                    Icon = "alert-circle"
                })
            end
        end
    end
})

DisasterSection:Divider()

DisasterSection:Toggle({
    Title = "地图投票用户界面",
    Desc = "显示/隐藏地图投票界面",
    Value = false,
    Callback = function(bool)
        game.Players.LocalPlayer.PlayerGui.MainGui.MapVotePage.Visible = bool
    end
})

DisasterSection:Toggle({
    Title = "在水上行走",
    Desc = "启用/禁用水面碰撞",
    Value = false,
    Callback = function(bool)
        if bool then
            game.Workspace.WaterLevel.CanCollide = true
            game.Workspace.WaterLevel.Size = Vector3.new(5000, 1, 5000)
        else
            game.Workspace.WaterLevel.CanCollide = false
            game.Workspace.WaterLevel.Size = Vector3.new(10, 1, 10)
        end
    end
})

DisasterSection:Toggle({
    Title = "使岛边缘有实体碰撞方块",
    Desc = "启用/禁用岛边缘碰撞",
    Value = false,
    Callback = function(bool)
        for i, v in pairs(game.workspace:GetDescendants()) do
            if v.Name == 'LowerRocks' then
                v.CanCollide = bool
            end
        end
    end
})

DisasterSection:Toggle({
    Title = "删除暴风雪沙尘暴界面显示",
    Desc = "移除暴风雪和沙尘暴的界面效果",
    Value = false,
    Callback = function(bool)
        if bool then
            if game.Players.LocalPlayer.PlayerGui:FindFirstChild("BlizzardGui") then
                game.Players.LocalPlayer.PlayerGui.BlizzardGui:Destroy()
            end
            if game.Players.LocalPlayer.PlayerGui:FindFirstChild("SandStormGui") then
                game.Players.LocalPlayer.PlayerGui.SandStormGui:Destroy()
            end
            WindUI:Notify({
                Title = "界面清理",
                Content = "灾难界面已移除",
                Duration = 3,
                Icon = "eye-off"
            })
        end
    end
})

DisasterSection:Divider()

DisasterSection:Button({
    Title = "传送到地图",
    Desc = "传送到主要地图位置",
    Callback = function()
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-115.828506, 65.4863434, 18.8461514, 0.00697017973, 0.0789371505, -0.996855199, -3.13589936e-07, 0.996879458, 0.0789390653, 0.999975681, -0.000549906865, 0.00694845384)
        WindUI:Notify({
            Title = "传送成功",
            Content = "已传送到地图位置",
            Duration = 2,
            Icon = "map-pin"
        })
    end
})

DisasterSection:Button({
    Title = "灾害岛",
    Desc = "传送到灾害岛(位置可能偏差)",
    Callback = function()
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-83.5, 38.5, -27.5, -1, 0, 0, 0, 1, 0, 0, 0, -1)
        WindUI:Notify({
            Title = "传送成功",
            Content = "已传送到灾害岛",
            Duration = 2,
            Icon = "map-pin"
        })
    end
})

DisasterSection:Button({
    Title = "主塔",
    Desc = "传送到主塔位置",
    Callback = function()
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-280, 180, 341, 1, 0, 0, 0, 1, 0, 0, 0, 1)
        WindUI:Notify({
            Title = "传送成功",
            Content = "已传送到主塔",
            Duration = 2,
            Icon = "map-pin"
        })
    end
})

local vu = game:GetService("VirtualUser")
game:GetService("Players").LocalPlayer.Idled:connect(function()
    vu:Button2Down(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
    wait(1)
    vu:Button2Up(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
end)

local CheeseSection = serve1:Section({Title = "奶酪逃生", Icon = "tornado", Opened = false})

CheeseSection:Button({
    Title = "奶酪逃生脚本",
    Desc = "制作Mtaskh",
    Icon = "geist:box",
    Callback = function()
        loadstring(game:HttpGet("https://github.com/mtaskhh/script/raw/refs/heads/main/nlts%20(1).lua"))()
    end
})

local KanshuSection = serve1:Section({Title = "砍伐树木", Icon = "tornado", Opened = false})

KanshuSection:Button({
    Title = "砍伐树木脚本",
    Desc = "制作Mtaskh", 
    Icon = "shift",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/mtaskhh/script/refs/heads/mt/kfsm"))()
    end
})

local shamoSection = serve1:Section({Title = "沙漠探测器", Icon = "tornado", Opened = false})

shamoSection:Button({
    Title = "沙漠探测器",
    Desc = "制作Mtaskh",
    Icon = "geist:rss",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/mtaskhh/script/refs/heads/main/smtc.lua"))()
    end
})

local zhishangSection = serve1:Section({Title = "智商测试", Icon = "tornado", Opened = false})

zhishangSection:Button({
    Title = "智商测试获取最大IQ",
    Desc = "获取后手动跳转到200层即可",
    Icon = "geist:robot",
    Callback = function()
        for i = 1, 200 do
    local args = {
        [1] = i
    }
    game:GetService("ReplicatedStorage").RemoteEvents.ChangeIQ:FireServer(unpack(args))
end
    end
})

local FESection = FETab:Section({Title = "FE脚本集", Opened = true})

FESection:Button({
    Title = "FE C00lgui",
    Callback = function()
        loadstring(game:GetObjects("rbxassetid://8127297852")[1].Source)()
    end
})

FESection:Button({
    Title = "FE 1x1x1x1", 
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/JipYNCht'),true))()
    end
})

FESection:Button({
    Title = "FE大长腿",
    Callback = function()
        loadstring(game:HttpGet('https://gist.githubusercontent.com/1BlueCat/7291747e9f093555573e027621f08d6e/raw/23b48f2463942befe19d81aa8a06e3222996242c/FE%2520Da%2520Feets'))()
    end
})

FESection:Button({
    Title = "FE用头",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/BK4Q0DfU"))()
    end
})

FESection:Button({
    Title = "复仇者",
    Callback = function()
        loadstring(game:HttpGet(('https://pastefy.ga/iGyVaTvs/raw'),true))()
    end
})

FESection:Button({
    Title = "鼠标",
    Callback = function()
        loadstring(game:HttpGet(('https://pastefy.ga/V75mqzaz/raw'),true))()
    end
})

FESection:Button({
    Title = "变怪物",
    Callback = function()
        loadstring(game:HttpGetAsync("https://pastebin.com/raw/jfryBKds"))()
    end
})

FESection:Button({
    Title = "香蕉枪",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/MrNeRD0/Doors-Hack/main/BananaGunByNerd.lua"))()
    end
})

FESection:Button({
    Title = "超长机巴",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/ESWSFND7", true))()
    end
})

FESection:Button({
    Title = "操人",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/XiaoYunCN/UWU/main/AHAJAJAKAK/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A/A.LUA", true))()
    end
})

FESection:Button({
    Title = "FE动画中心",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/GamingScripter/Animation-Hub/main/Animation%20Gui", true))()
    end
})

FESection:Button({
    Title = "FE变玩家",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/XR4sGcgJ"))()
    end
})

FESection:Button({
    Title = "FE猫娘R63",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Tescalus/Pendulum-Hubs-Source/main/Pendulum%20Hub%20V5.lua"))()
    end
})

FESection:Button({
    Title = "FE脚本",
    Callback = function()
        loadstring(game:HttpGet('https://pastefy.ga/a7RTi4un/raw'))()
    end
})

local MusicSection = MusicTab:Section({Title = "音乐控制", Icon="lucide:activity",Opened = false})

local currentSound = nil
local isPlaying = false

local musicLibrary = {
    ["Ambush音效"] = 10722835168,
    ["Rush音效"] = 10803213909,
    ["Seek音效"] = 10642752409,
    ["绿脸音效"] = 9113115842,
    ["TheHunt倒计时结束"] = 16695021133,
    ["TheHunt倒计时开始"] = 16695384009,
    ["结束追杀音效"] = 16695425474,
    ["获取金币音效"] = 8646410774,
    
    ["Bad to the Bone"] = 6965169740,
    ["钢管落地(大声)"] = 6729922069,
    ["Grand Dad音效"] = 848785973,
    ["Taco Bell音效"] = 5523122402,
    ["Cloaker音效"] = 231777931,
    ["You Are An Idiot"] = 2665943889,
    
    ["T阵营胜利音乐"] = 1420383375,
    ["C4倒计时"] = 4873271533,
    ["C4爆炸"] = 4854660190,
    ["闪光弹爆炸"] = 9114799182,
    ["C4被拆除"] = 9117341652,
    ["安放C4"] = 4915042781,
    ["手雷扔出"] = 5124872763,
    
    ["Ouch!"] = 12222058,
    ["通用Meme音效"] = 5257196749,
    ["Nope Meme"] = 6346074926,
    ["粗口"] = 7334239757,
    ["窜稀音效"] = 4809574295,
    ["苹果手机闹钟"] = 4203251375,
    ["Windows错误提示音"] = 2661731024,
    ["OMG~"] = 336771379,
    
    ["钢管落地"] = 6011094380,
    ["核弹爆炸"] = 421256280,
    ["核弹爆炸倒计时"] = 6456981311,
    ["警报声"] = 675587093,
    ["警报声(另一种)"] = 4988826279,
    ["Minecraft门关闭"] = 180090455,
    ["Minecraft受伤音效"] = 6361963422,
    ["Minecraft吃东西"] = 6748255118,
    
    ["Lo-fi Chill音乐"] = 9043887091,
    ["Clair De Lune (月光)"] = 1838457617,
    ["投弹兵进行曲"] = 1840172845,
    ["《起风了》"] = 7548510678,
    ["《海阔天空》"] = 3875049052,
    ["《光辉岁月》"] = 6116888743,
    ["安静的住宅区音乐"] = 1845554017,
    ["From La With Love"] = 9046864900,
    
    ["No Light"] = 14145623221,
    ["Bell Pepper"] = 14145626111,
    ["The Final Phonk"] = 14145620056,
    ["Baller (原版)"] = 13530438299
}

local function stopMusic()
    if currentSound then
        currentSound:Stop()
        currentSound:Destroy()
        currentSound = nil
    end
    isPlaying = false
end

local function playMusic(soundId, musicName)
    stopMusic()
    
    currentSound = Instance.new("Sound")
    currentSound.SoundId = "rbxassetid://" .. soundId
    currentSound.Parent = game:GetService("SoundService")
    currentSound.Volume = 0.5
    currentSound.Looped = false
    
    currentSound.Ended:Connect(function()
        isPlaying = false
        WindUI:Notify({
            Title = "音乐播放结束",
            Content = musicName .. " 已播放完毕",
            Duration = 3,
            Icon = "music"
        })
    end)
    
    currentSound:Play()
    isPlaying = true
    
    WindUI:Notify({
        Title = "正在播放",
        Content = musicName,
        Duration = 3,
        Icon = "play"
    })
end

MusicSection:Button({
    Title = "停止播放",
    Desc = "停止当前播放的音乐",
    Icon = "square",
    Callback = function()
        stopMusic()
        WindUI:Notify({
            Title = "音乐已停止",
            Content = "所有音乐播放已停止",
            Duration = 3,
            Icon = "square"
        })
    end
})

local VolumeSlider = MusicSection:Slider({
    Title = "音量控制",
    Desc = "调整音乐音量大小",
    Step = 0.1,
    Value = {
        Min = 0,
        Max = 1,
        Default = 0.5
    },
    Callback = function(Value)
        if currentSound then
            currentSound.Volume = Value
        end
    end
})

MusicSection:Input({
    Title = "自定义音乐ID",
    Desc = "输入Roblox音效ID",
    Placeholder = "例如: 10722835168",
    Callback = function(Value)
        if Value and Value ~= "" then
            local soundId = tonumber(Value)
            if soundId then
                playMusic(soundId, "自定义音乐")
            else
               print ("请输入有效的数字id")
            end
        end
    end
})

local function createMusicButtons(categoryName, musicList)
    local categorySection = MusicTab:Section({
        Title = categoryName,
        Icon="lucide:cassette-tape",
        Opened = false
    })
    
    for musicName, soundId in pairs(musicList) do
        categorySection:Button({
            Title = musicName,
            Desc = "ID: " .. soundId,
            Callback = function()
                playMusic(soundId, musicName)
            end
        })
    end
end

local categorizedMusic = {
    ["Doors音效"] = {
        ["Ambush音效"] = 10722835168,
        ["Rush音效"] = 10803213909,
        ["Seek音效"] = 10642752409,
        ["绿脸音效"] = 9113115842,
        ["TheHunt倒计时结束"] = 16695021133,
        ["TheHunt倒计时开始"] = 16695384009,
        ["结束追杀音效"] = 16695425474,
        ["获取金币音效"] = 8646410774
    },
    
    ["游戏音效"] = {
        ["Bad to the Bone"] = 6965169740,
        ["钢管落地(大声)"] = 6729922069,
        ["T阵营胜利音乐"] = 1420383375,
        ["C4倒计时"] = 4873271533,
        ["C4爆炸"] = 4854660190,
        ["闪光弹爆炸"] = 9114799182
    },
    
    ["MEME音效"] = {
        ["Ouch!"] = 12222058,
        ["通用Meme音效"] = 5257196749,
        ["Nope Meme"] = 6346074926,
        ["苹果手机闹钟"] = 4203251375,
        ["Windows错误提示音"] = 2661731024,
        ["OMG~"] = 336771379
    },
    
    ["环境音效"] = {
        ["钢管落地"] = 6011094380,
        ["核弹爆炸"] = 421256280,
        ["警报声"] = 675587093,
        ["Minecraft门关闭"] = 180090455,
        ["Minecraft受伤音效"] = 6361963422
    },
    
    ["音乐曲目"] = {
        ["Lo-fi Chill音乐"] = 9043887091,
        ["Clair De Lune (月光)"] = 1838457617,
        ["投弹兵进行曲"] = 1840172845,
        ["《起风了》"] = 7548510678,
        ["《海阔天空》"] = 3875049052,
        ["《光辉岁月》"] = 6116888743
    },
    
    ["Phonk音乐"] = {
        ["No Light"] = 14145623221,
        ["Bell Pepper"] = 14145626111,
        ["The Final Phonk"] = 14145620056,
        ["Baller (原版)"] = 13530438299
    }
}

for categoryName, musicList in pairs(categorizedMusic) do
    createMusicButtons(categoryName, musicList)
end

Window:SelectTab(2)

print("挽脚本加载完成(◍•ᴗ•◍)")

WindUI:Notify({
    Title = "挽脚本加载完成",
    Content = "欢迎 " .. game.Players.LocalPlayer.DisplayName .. " 使用挽脚本",
    Duration = 3,
    Icon = "crown"
})

wait (0.5)

WindUI:Notify({
    Title = "标题旁可切换主题",
    Content = "没用的功能(bushi",
    Duration = 3,
    Icon = "sun"
})
